/* abyssa 3.0.1 - A stateful router library for single page applications */

!function(a){"object"==typeof exports?module.exports=a():"function"==typeof define&&define.amd?define(a):"undefined"!=typeof window?window.Abyssa=a():"undefined"!=typeof global?global.Abyssa=a():"undefined"!=typeof self&&(self.Abyssa=a())}(function(){var a;return function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};a[g][0].call(j.exports,function(b){var c=a[g][1][b];return e(c?c:b)},j,j.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(b,c){!function(){var d=function(a){function b(a,b){if(a.indexOf)return a.indexOf(b);for(var c=a.length;c--;)if(a[c]===b)return c;return-1}function c(a,c){var d=b(a,c);-1!==d&&a.splice(d,1)}function d(a,b){return"[object "+b+"]"===Object.prototype.toString.call(a)}function e(a){return d(a,"RegExp")}function f(a){return d(a,"Array")}function g(a){return"function"==typeof a}function h(a){var b;return b=null===a||"null"===a?null:"true"===a?!0:"false"===a?!1:a===o||"undefined"===a?o:""===a||isNaN(a)?a:parseFloat(a)}function i(a){for(var b=a.length,c=[];b--;)c[b]=h(a[b]);return c}function j(a,b){for(var c,d,e=(a||"").replace("?","").split("&"),f=e.length,g={};f--;)c=e[f].split("="),d=b?h(c[1]):c[1],g[c[0]]="string"==typeof d?decodeURIComponent(d):d;return g}function k(){this.bypassed=new a.Signal,this.routed=new a.Signal,this._routes=[],this._prevRoutes=[],this._piped=[],this.resetState()}function l(b,c,d,f){var g=e(b),h=f.patternLexer;this._router=f,this._pattern=b,this._paramsIds=g?null:h.getParamIds(b),this._optionalParamsIds=g?null:h.getOptionalParamsIds(b),this._matchRegexp=g?b:h.compilePattern(b,f.ignoreCase),this.matched=new a.Signal,this.switched=new a.Signal,c&&this.matched.add(c),this._priority=d||0}var m,n,o;return n=""===/t(.+)?/.exec("t")[1],k.prototype={greedy:!1,greedyEnabled:!0,ignoreCase:!0,ignoreState:!1,shouldTypecast:!1,normalizeFn:null,resetState:function(){this._prevRoutes.length=0,this._prevMatchedRequest=null,this._prevBypassedRequest=null},create:function(){return new k},addRoute:function(a,b,c){var d=new l(a,b,c,this);return this._sortedInsert(d),d},removeRoute:function(a){c(this._routes,a),a._destroy()},removeAllRoutes:function(){for(var a=this.getNumRoutes();a--;)this._routes[a]._destroy();this._routes.length=0},parse:function(a,b){if(a=a||"",b=b||[],this.ignoreState||a!==this._prevMatchedRequest&&a!==this._prevBypassedRequest){var c,d=this._getMatchedRoutes(a),e=0,f=d.length;if(f)for(this._prevMatchedRequest=a,this._notifyPrevRoutes(d,a),this._prevRoutes=d;f>e;)c=d[e],c.route.matched.dispatch.apply(c.route.matched,b.concat(c.params)),c.isFirst=!e,this.routed.dispatch.apply(this.routed,b.concat([a,c])),e+=1;else this._prevBypassedRequest=a,this.bypassed.dispatch.apply(this.bypassed,b.concat([a]));this._pipeParse(a,b)}},_notifyPrevRoutes:function(a,b){for(var c,d=0;c=this._prevRoutes[d++];)c.route.switched&&this._didSwitch(c.route,a)&&c.route.switched.dispatch(b)},_didSwitch:function(a,b){for(var c,d=0;c=b[d++];)if(c.route===a)return!1;return!0},_pipeParse:function(a,b){for(var c,d=0;c=this._piped[d++];)c.parse(a,b)},getNumRoutes:function(){return this._routes.length},_sortedInsert:function(a){var b=this._routes,c=b.length;do--c;while(b[c]&&a._priority<=b[c]._priority);b.splice(c+1,0,a)},_getMatchedRoutes:function(a){for(var b,c=[],d=this._routes,e=d.length;(b=d[--e])&&((!c.length||this.greedy||b.greedy)&&b.match(a)&&c.push({route:b,params:b._getParamsArray(a)}),this.greedyEnabled||!c.length););return c},pipe:function(a){this._piped.push(a)},unpipe:function(a){c(this._piped,a)},toString:function(){return"[crossroads numRoutes:"+this.getNumRoutes()+"]"}},m=new k,m.VERSION="0.12.0",m.NORM_AS_ARRAY=function(a,b){return[b.vals_]},m.NORM_AS_OBJECT=function(a,b){return[b]},l.prototype={greedy:!1,rules:void 0,match:function(a){return a=a||"",this._matchRegexp.test(a)&&this._validateParams(a)},_validateParams:function(a){var b,c=this.rules,d=this._getParamsObject(a);for(b in c)if("normalize_"!==b&&c.hasOwnProperty(b)&&!this._isValidParam(a,b,d))return!1;return!0},_isValidParam:function(a,c,d){var h=this.rules[c],i=d[c],j=!1,k=0===c.indexOf("?");return null==i&&this._optionalParamsIds&&-1!==b(this._optionalParamsIds,c)?j=!0:e(h)?(k&&(i=d[c+"_"]),j=h.test(i)):f(h)?(k&&(i=d[c+"_"]),j=this._isValidArrayRule(h,i)):g(h)&&(j=h(i,a,d)),j},_isValidArrayRule:function(a,c){if(!this._router.ignoreCase)return-1!==b(a,c);"string"==typeof c&&(c=c.toLowerCase());for(var d,e,f=a.length;f--;)if(d=a[f],e="string"==typeof d?d.toLowerCase():d,e===c)return!0;return!1},_getParamsObject:function(a){for(var c,d,e=this._router.shouldTypecast,f=this._router.patternLexer.getParamValues(a,this._matchRegexp,e),g={},i=f.length;i--;)d=f[i],this._paramsIds&&(c=this._paramsIds[i],0===c.indexOf("?")&&d&&(g[c+"_"]=d,d=j(d,e),f[i]=d),n&&""===d&&-1!==b(this._optionalParamsIds,c)&&(d=void 0,f[i]=d),g[c]=d),g[i]=d;return g.request_=e?h(a):a,g.vals_=f,g},_getParamsArray:function(a){var b,c=this.rules?this.rules.normalize_:null;return c=c||this._router.normalizeFn,b=c&&g(c)?c(a,this._getParamsObject(a)):this._getParamsObject(a).vals_},interpolate:function(a){var b=this._router.patternLexer.interpolate(this._pattern,a);if(!this._validateParams(b))throw new Error("Generated string doesn't validate against `Route.rules`.");return b},dispose:function(){this._router.removeRoute(this)},_destroy:function(){this.matched.dispose(),this.switched.dispose(),this.matched=this.switched=this._pattern=this._matchRegexp=null},toString:function(){return'[Route pattern:"'+this._pattern+'", numListeners:'+this.matched.getNumListeners()+"]"}},k.prototype.patternLexer=function(){function a(){var a,b;for(a in n)n.hasOwnProperty(a)&&(b=n[a],b.id="__CR_"+a+"__",b.save="save"in b?b.save.replace("{{id}}",b.id):b.id,b.rRestore=new RegExp(b.id,"g"))}function b(a,b){var c,d=[];for(a.lastIndex=0;c=a.exec(b);)d.push(c[1]);return d}function c(a){return b(m,a)}function d(a){return b(n.OP.rgx,a)}function e(a,b){return a=a||"",a&&(r===o?a=a.replace(k,""):r===q&&(a=a.replace(l,"")),a=f(a,"rgx","save"),a=a.replace(j,"\\$&"),a=f(a,"rRestore","res"),r===o&&(a="\\/?"+a)),r!==p&&(a+="\\/?"),new RegExp("^"+a+"$",b?"i":"")}function f(a,b,c){var d,e;for(e in n)n.hasOwnProperty(e)&&(d=n[e],a=a.replace(d[b],d[c]));return a}function g(a,b,c){var d=b.exec(a);return d&&(d.shift(),c&&(d=i(d))),d}function h(a,b){if("string"!=typeof a)throw new Error("Route pattern should be a string.");var c=function(a,c){var d;if(c="?"===c.substr(0,1)?c.substr(1):c,null!=b[c]){if("object"==typeof b[c]){var e=[];for(var f in b[c])e.push(encodeURI(f+"="+b[c][f]));d="?"+e.join("&")}else d=String(b[c]);if(-1===a.indexOf("*")&&-1!==d.indexOf("/"))throw new Error('Invalid value "'+d+'" for segment "'+a+'".')}else{if(-1!==a.indexOf("{"))throw new Error("The segment "+a+" is required.");d=""}return d};return n.OS.trail||(n.OS.trail=new RegExp("(?:"+n.OS.id+")+$")),a.replace(n.OS.rgx,n.OS.save).replace(m,c).replace(n.OS.trail,"").replace(n.OS.rRestore,"/")}var j=/[\\.+*?\^$\[\](){}\/'#]/g,k=/^\/|\/$/g,l=/\/$/g,m=/(?:\{|:)([^}:]+)(?:\}|:)/g,n={OS:{rgx:/([:}]|\w(?=\/))\/?(:|(?:\{\?))/g,save:"$1{{id}}$2",res:"\\/?"},RS:{rgx:/([:}])\/?(\{)/g,save:"$1{{id}}$2",res:"\\/"},RQ:{rgx:/\{\?([^}]+)\}/g,res:"\\?([^#]+)"},OQ:{rgx:/:\?([^:]+):/g,res:"(?:\\?([^#]*))?"},OR:{rgx:/:([^:]+)\*:/g,res:"(.*)?"},RR:{rgx:/\{([^}]+)\*\}/g,res:"(.+)"},RP:{rgx:/\{([^}]+)\}/g,res:"([^\\/?]+)"},OP:{rgx:/:([^:]+):/g,res:"([^\\/?]+)?/?"}},o=1,p=2,q=3,r=o;return a(),{strict:function(){r=p},loose:function(){r=o},legacy:function(){r=q},getParamIds:c,getOptionalParamsIds:d,getParamValues:g,compilePattern:e,interpolate:h}}(),m};"function"==typeof a&&a.amd?a(["signals"],d):"undefined"!=typeof c&&c.exports?c.exports=d(b("signals")):window.crossroads=d(window.signals)}()},{signals:3}],2:[function(a,b){var c=b.exports={};c.nextTick=function(){var a="undefined"!=typeof window&&window.setImmediate,b="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(a)return function(a){return window.setImmediate(a)};if(b){var c=[];return window.addEventListener("message",function(a){if(a.source===window&&"process-tick"===a.data&&(a.stopPropagation(),c.length>0)){var b=c.shift();b()}},!0),function(a){c.push(a),window.postMessage("process-tick","*")}}return function(a){setTimeout(a,0)}}(),c.title="browser",c.browser=!0,c.env={},c.argv=[],c.binding=function(){throw new Error("process.binding is not supported")},c.cwd=function(){return"/"},c.chdir=function(){throw new Error("process.chdir is not supported")}},{}],3:[function(b,c){!function(b){function d(a,b,c,d,e){this._listener=b,this._isOnce=c,this.context=d,this._signal=a,this._priority=e||0}function e(a,b){if("function"!=typeof a)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",b))}function f(){this._bindings=[],this._prevParams=null;var a=this;this.dispatch=function(){f.prototype.dispatch.apply(a,arguments)}}d.prototype={active:!0,params:null,execute:function(a){var b,c;return this.active&&this._listener&&(c=this.params?this.params.concat(a):a,b=this._listener.apply(this.context,c),this._isOnce&&this.detach()),b},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},f.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(a,b,c,e){var f,g=this._indexOfListener(a,c);if(-1!==g){if(f=this._bindings[g],f.isOnce()!==b)throw new Error("You cannot add"+(b?"":"Once")+"() then add"+(b?"Once":"")+"() the same listener without removing the relationship first.")}else f=new d(this,a,b,c,e),this._addBinding(f);return this.memorize&&this._prevParams&&f.execute(this._prevParams),f},_addBinding:function(a){var b=this._bindings.length;do--b;while(this._bindings[b]&&a._priority<=this._bindings[b]._priority);this._bindings.splice(b+1,0,a)},_indexOfListener:function(a,b){for(var c,d=this._bindings.length;d--;)if(c=this._bindings[d],c._listener===a&&c.context===b)return d;return-1},has:function(a,b){return-1!==this._indexOfListener(a,b)},add:function(a,b,c){return e(a,"add"),this._registerListener(a,!1,b,c)},addOnce:function(a,b,c){return e(a,"addOnce"),this._registerListener(a,!0,b,c)},remove:function(a,b){e(a,"remove");var c=this._indexOfListener(a,b);return-1!==c&&(this._bindings[c]._destroy(),this._bindings.splice(c,1)),a},removeAll:function(){for(var a=this._bindings.length;a--;)this._bindings[a]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active){var a,b=Array.prototype.slice.call(arguments),c=this._bindings.length;if(this.memorize&&(this._prevParams=b),c){a=this._bindings.slice(),this._shouldPropagate=!0;do c--;while(a[c]&&this._shouldPropagate&&a[c].execute(b)!==!1)}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var g=f;g.Signal=f,"function"==typeof a&&a.amd?a(function(){return g}):"undefined"!=typeof c&&c.exports?c.exports=g:b.signals=g}(this)},{}],4:[function(b,c){var d=b("__browserify_process");!function(a){"use strict";a(function(a){function b(a,b,d,e){return c(a).then(b,d,e)}function c(a){return a instanceof e?a:f(a)}function e(a,b){this._message=a,this.inspect=b}function f(a){return i(function(b){b(a)})}function g(a){return b(a,m)}function h(){function a(a,e,g){b.resolve=b.resolver.resolve=function(b){return d?f(b):(d=!0,a(b),c)},b.reject=b.resolver.reject=function(a){return d?f(m(a)):(d=!0,e(a),c)},b.notify=b.resolver.notify=function(a){return g(a),a}}var b,c,d;return b={promise:X,resolve:X,reject:X,notify:X,resolver:{resolve:X,reject:X,notify:X}},b.promise=c=i(a),b}function i(a){return j(a,T.PromiseStatus&&T.PromiseStatus())}function j(a,b){function c(a,b,c,d){function e(e){e._message(a,b,c,d)}l?l.push(e):G(function(){e(j)})}function d(){return j?j.inspect():F()}function f(a){if(l){var c=l;l=X,G(function(){j=p(i,a),b&&t(j,b),k(c,j)})}}function g(a){f(m(a))}function h(a){if(l){var b=l;G(function(){k(b,o(a))})}}var i,j,l=[];i=new e(c,d),i._status=b;try{a(f,g,h)}catch(n){g(n)}return i}function k(a,b){for(var c=0;c<a.length;c++)a[c](b)}function l(a){return n(new r(a),function(){return D(a)})}function m(a){return n(new s(a),function(){return E(a)})}function n(a,b){return new e(function(b,c,d){try{d(a[b].apply(a,c))}catch(e){d(m(e))}},b)}function o(a){return new e(function(b,c,d,e){var f=c[2];try{e("function"==typeof f?f(a):a)}catch(g){e(g)}})}function p(a,b){if(b===a)return m(new TypeError);if(b instanceof e)return b;try{var c=b===Object(b)&&b.then;return"function"==typeof c?q(c,b):l(b)}catch(d){return m(d)}}function q(a,b){return i(function(c,d){N(a,b,c,d)})}function r(a){this.value=a}function s(a){this.reason=a}function t(a,b){function c(){b.fulfilled()}function d(a){b.rejected(a)}a.then(c,d)}function u(a){return a&&"function"==typeof a.then}function v(a,c,d,e,f){return b(a,function(a){function g(d,e,f){function g(a){n(a)}function h(a){m(a)}var i,j,k,l,m,n,o,p;if(o=a.length>>>0,i=Math.max(0,Math.min(c,o)),k=[],j=o-i+1,l=[],i)for(n=function(a){l.push(a),--j||(m=n=I,e(l))},m=function(a){k.push(a),--i||(m=n=I,d(k))},p=0;o>p;++p)p in a&&b(a[p],h,g,f);else d(k)}return i(g).then(d,e,f)})}function w(a,b,c,d){function e(a){return b?b(a[0]):a[0]}return v(a,1,e,c,d)}function x(a,b,c,d){return B(a,I).then(b,c,d)}function y(){return B(arguments,I)}function z(a){return B(a,D,E)}function A(a,b){return B(a,b)}function B(a,c,d){return b(a,function(a){function e(e,f,g){function h(a,h){b(a,c,d).then(function(a){i[h]=a,--k||e(i)},f,g)}var i,j,k,l;if(k=j=a.length>>>0,i=[],!k)return e(i),void 0;for(l=0;j>l;l++)l in a?h(a[l],l):--k}return j(e)})}function C(a,c){var d=N(M,arguments,1);return b(a,function(a){var e;return e=a.length,d[0]=function(a,d,f){return b(a,function(a){return b(d,function(b){return c(a,b,f,e)})})},L.apply(a,d)})}function D(a){return{state:"fulfilled",value:a}}function E(a){return{state:"rejected",reason:a}}function F(){return{state:"pending"}}function G(a){1===P.push(a)&&O(H)}function H(){k(P),P=[]}function I(a){return a}function J(a){throw"function"==typeof T.reportUnhandled?T.reportUnhandled():G(function(){throw a}),a}b.promise=i,b.resolve=f,b.reject=g,b.defer=h,b.join=y,b.all=x,b.map=A,b.reduce=C,b.settle=z,b.any=w,b.some=v,b.isPromise=u,b.isPromiseLike=u;var K=e.prototype;K.then=function(){var a,b;return a=arguments,b=this._message,j(function(c,d,e){b("when",a,c,e)},this._status&&this._status.observed())},K["catch"]=K.otherwise=function(a){return this.then(X,a)},K["finally"]=K.ensure=function(a){function b(){return f(a())}return"function"==typeof a?this.then(b,b).yield(this):this},K.done=function(a,b){this.then(a,b).otherwise(J)},K.yield=function(a){return this.then(function(){return a})},K.tap=function(a){return this.then(a).yield(this)},K.spread=function(a){return this.then(function(b){return x(b,function(b){return a.apply(X,b)})})},K.always=function(a,b){return this.then(a,a,b)},r.prototype.when=function(a){return"function"==typeof a?a(this.value):this.value},s.prototype.when=function(a,b){if("function"==typeof b)return b(this.reason);throw this.reason};var L,M,N,O,P,Q,R,S,T,U,V,W,X;if(V=a,P=[],T="undefined"!=typeof console?console:b,"object"==typeof d&&d.nextTick)O=d.nextTick;else if(W="function"==typeof MutationObserver&&MutationObserver||"function"==typeof WebKitMutationObserver&&WebKitMutationObserver)O=function(a,b,c){var d=a.createElement("div");return new b(c).observe(d,{attributes:!0}),function(){d.setAttribute("x","x")}}(document,W,H);else try{O=V("vertx").runOnLoop||V("vertx").runOnContext}catch(Y){U=setTimeout,O=function(a){U(a,0)}}return Q=Function.prototype,R=Q.call,N=Q.bind?R.bind(R):function(a,b){return a.apply(b,M.call(arguments,2))},S=[],M=S.slice,L=S.reduce||function(a){var b,c,d,e,f;if(f=0,b=Object(this),e=b.length>>>0,c=arguments,c.length<=1)for(;;){if(f in b){d=b[f++];break}if(++f>=e)throw new TypeError}else d=c[1];for(;e>f;++f)f in b&&(d=a(d,b[f],f,b));return d},b})}("function"==typeof a&&a.amd?a:function(a){c.exports=a(b)})},{__browserify_process:2}],5:[function(a,b){"use strict";function c(a){function b(a,b){if(!s(a,b)){var c,d=g(a,b);O?(l(),c=g(O.currentState,O.toParams)):c=N,N=d,N._pathQuery=M,R&&q(c._pathQuery,document.title,c._pathQuery),m(c,d),O=h(c,d,t(c&&c.params,b)),O.then(function(){O=null,R||W||(j("Pushing state: {0}",M),r(M,document.title,M)),R&&q(N._pathQuery,document.title,N._pathQuery),n(c,d)},function(a){O=null,N=c,o(c,d,a)}).otherwise(p)}}function l(){j("Cancelling existing transition from {0} to {1}",O.from,O.to),O.cancel(),W=!1,T.transition.cancelled.dispatch(O.to,O.from)}function m(a,b){j("Starting transition from {0} to {1}",a,b),T.transition.started.dispatch(b,a)}function n(a,b){j("Transition from {0} to {1} completed",a,b),W=!1,b._state.lastParams=b.params,T.transition.completed.dispatch(b,a)}function o(a,b,c){throw k("Transition from {0} to {1} failed: {2}",a,b,c),T.transition.failed.dispatch(b,a),c}function p(a){return a.isTransitionError?k(a):(setTimeout(function(){throw a},0),void 0)}function q(a,b,c){history.emulate&&(Y=!0),history.replaceState(a,b,c)}function r(a,b,c){history.emulate&&(Y=!0),history.pushState(a,b,c)}function s(a,b){var c,d,e;return O?(c=O.to,d=O.toParams):N&&(c=N._state,d=N.params),e=t(d,b),a==c&&0==i.objectSize(e)}function t(a,b){var c={},a=a||{};for(var d in a)a[d]!=b[d]&&(c[d]=1);for(var d in b)a[d]!=b[d]&&(c[d]=1);return c}function u(a){if(j("State not found: {0}",a),!X.notFound)throw new Error('State "'+a+'" could not be found');b(X.notFound)}function v(a){return i.mergeObjects(X,a),T}function w(a,b){return X.enableLogs&&c.enableLogs(),X.interceptAnchorClicks&&f(T),j("Router init"),x(),a=void 0!==a?a:G(),j("Initializing to state {0}",a||'""'),A(a,b),window.onpopstate=function(a){if(Y)return Y=!1,void 0;var b=a.state||G();j("Popped state: {0}",b),R=!0,D(b)},S=!0,T}function x(){y(function(a,b){b.init(T,a)}),X.notFound&&X.notFound.init("notFound"),P={},z(function(a){P[a.fullName]=a,a.route=V.addRoute(a.fullPath()+":?query:"),a.route.matched.add(function(){Q=!0,b(a,H(a,arguments))})})}function y(a){for(var b in U)a(b,U[b])}function z(a){function b(c){c.forEach(function(c){c.children.length?b(c.children):a(c)})}b(i.objectToArray(U))}function A(a,b){var c=void 0!==P[a];j("Changing state to {0}",a||'""'),R=!1,c?E(a,b||{}):D(a)}function B(a,b){j("Redirecting..."),A(a,b)}function C(a,b){var c=P[a].lastParams||b;A(a,c)}function D(a){M=i.normalizePathQuery(a),Q=!1,V.parse(M),Q||u(M)}function E(a,b){var c=P[a];if(!c)return u(a);var d=c.route.interpolate(I(c,b));D(d)}function F(a,b){if(S)throw new Error("States can only be added before the Router is initialized");if(U[a])throw new Error("A state already exist in the router with the name "+a);return j("Adding state {0}",a),U[a]=b,T}function G(){var a=location.href.indexOf("#/"),b=a>-1?location.href.slice(a+2):(location.pathname+location.search).slice(1);return i.normalizePathQuery(b)}function H(a,b){var c,d=Array.prototype.slice.apply(b),e=d.pop(),f={};a.fullPath().replace(/\{\w*\}/g,function(a){return c=a.slice(1,-1),f[c]=d.shift(),""}),e&&i.mergeObjects(f,e);for(var g in f)i.isString(f[g])&&(f[g]=decodeURIComponent(f[g]));return f}function I(a,b){var c={};for(var d in b)a.queryParams[d]?(c.query=c.query||{},c.query[d]=b[d]):c[d]=b[d];return c}function J(a,b){var c={},d={},e=!1,f=P[a];if(!f)throw new Error("Cannot find state "+a);[f].concat(f.parents).forEach(function(a){i.mergeObjects(d,a.queryParams)});for(var g in b)d[g]&&(c[g]=b[g],delete b[g],e=!0);return e&&(b.query=c),i.normalizePathQuery(f.route.interpolate(b))}function K(){return N}function L(a,b){T.transition.ended.dispatch(a,b)}var M,N,O,P,Q,R,S,T={},U=i.copyObject(a),V=e.create(),W=!0,X={enableLogs:!1,interceptAnchorClicks:!0},Y=!1;return V.shouldTypecast=!0,V.ignoreState=!0,T.configure=v,T.init=w,T.state=A,T.redirect=B,T.backTo=C,T.addState=F,T.link=J,T.currentState=K,T.urlPathQuery=G,T.transition={started:new d,ended:new d,completed:new d,failed:new d,cancelled:new d},T.initialized=new d,T.changed=T.transition.completed,T.transition.completed.addOnce(function(){T.initialized.dispatch()}),T.transition.completed.add(L),T.transition.failed.add(L),T.transition.cancelled.add(L),T}var d=a("signals").Signal,e=a("crossroads"),f=a("./anchorClicks"),g=a("./StateWithParams"),h=a("./Transition"),i=a("./util"),j=i.noop,k=i.noop;c.enableLogs=function(){j=function(){var a=i.makeMessage.apply(null,arguments);console.log(a)},k=function(){var a=i.makeMessage.apply(null,arguments);console.error(a)}},b.exports=c},{"./StateWithParams":7,"./Transition":8,"./anchorClicks":9,"./util":11,crossroads:1,signals:3}],6:[function(a,b){"use strict";function c(){function a(a,b,d){p.router=a,p.name=b,p.parent=d,p.parents=c(),p.children=g(),p.fullName=i(),p.root=p.parents[p.parents.length-1],p.async=f,l(function(b,c){c.init(a,b,p)}),o=!0}function b(){for(var a=p.path,b=p.parent;b;)b.path&&(a=b.path+"/"+a),b=b.parent;return a}function c(){for(var a=[],b=p.parent;b;)a.push(b),b=b.parent;return a}function g(){var a=[];for(var b in s)a.push(s[b]);return a}function h(a){var b={};for(var c in a)a[c]._isState&&(b[c]=a[c]);return b}function i(){return p.parents.reduceRight(function(a,b){return a+b.name+"."},"")+p.name}function j(a){var b={enter:1,exit:1,enterPrereqs:1,exitPrereqs:1},c={};for(var d in a)b[d]||a[d]._isState||(c[d]=a[d]);return c}function k(a,b){if(void 0!==b){if(void 0!==p.ownData[a])throw new Error("State "+p.fullName+" already has data with the key "+a);return p.ownData[a]=b,p}for(var c=p;void 0===c.ownData[a]&&c.parent;)c=c.parent;return c.ownData[a]}function l(a){for(var b in s)a(b,s[b])}function m(a,b){if(o)throw new Error("States can only be added before the Router is initialized");if(s[a])throw new Error("The state {0} already has a child state named {1}".replace("{0}",p.name).replace("{1}",a));return s[a]=b,p}function n(){return p.fullName}var o,p={_isState:!0},q=d(arguments),r=q.options,s=h(q.options);return p.path=q.path,p.params=q.params,p.queryParams=q.queryParams,p.states=s,p.enter=r.enter||e.noop,p.exit=r.exit||e.noop,p.enterPrereqs=r.enterPrereqs,p.exitPrereqs=r.exitPrereqs,p.ownData=j(r),p.init=a,p.fullPath=b,p.data=k,p.addState=m,p.toString=n,p}function d(a){var b,c,d={path:"",options:{},params:{},queryParams:{}},f=a[0],g=a[1];return 1==a.length?e.isString(f)?d.path=f:d.options=f:2==a.length&&(d.path=f,d.options="object"==typeof g?g:{enter:g}),b=d.path.indexOf("?"),-1!=b&&(d.queryParams=d.path.slice(b+1),d.path=d.path.slice(0,b),d.queryParams=e.arrayToObject(d.queryParams.split("&"))),d.path=d.path.replace(/:\w*/g,function(a){return c=a.substring(1),d.params[c]=1,"{"+c+"}"}),d}var e=a("./util"),f=a("./Transition").asyncPromises.register;b.exports=c},{"./Transition":8,"./util":11}],7:[function(a,b){"use strict";function c(a,b){return{_state:a,name:a&&a.name,fullName:a&&a.fullName,data:a&&a.data,params:b,is:d,isIn:e,toString:f}}function d(a){return this.fullName==a}function e(a){for(var b=this._state;b;){if(b.fullName==a)return!0;b=b.parent}return!1}function f(){return this.fullName+":"+JSON.stringify(this.params)}b.exports=c},{}],8:[function(a,b){"use strict";function c(a,b,c){function g(a,b){return n.then(function(){k||a()},function(a){k||b(a)})}function i(){k=t.cancelled=!0}var j,k,m,n,o=[],p=a&&a._state,q=b._state,r=b.params,s=p==q,t={from:p,to:q,toParams:r,then:g,cancel:i,cancelled:k,currentState:p};return p&&(j=f(p,q,s,c),o=h(p,j,s)),m=h(q,j,s).reverse(),n=d(m,o,r).then(function(){k||e(m,o,r,t)}),l.newTransitionStarted(),t}function d(a,b,c){return b.forEach(function(a){if(a.exitPrereqs)var b=a._exitPrereqs=j(a.exitPrereqs()).then(function(c){a._exitPrereqs==b&&(a._exitPrereqs.value=c)},function(b){var c=k.makeMessage('Failed to resolve EXIT prereqs of "{0}"',a.fullName);throw i(c,b)})}),a.forEach(function(a){if(a.enterPrereqs)var b=a._enterPrereqs=j(a.enterPrereqs(c)).then(function(c){a._enterPrereqs==b&&(a._enterPrereqs.value=c)},function(b){var c=k.makeMessage('Failed to resolve ENTER prereqs of "{0}"',a.fullName);throw i(c,b)})}),j.all(a.concat(b).map(function(a){return a._enterPrereqs||a._exitPrereqs}))}function e(a,b,c,d){b.forEach(function(a){a.exit(a._exitPrereqs&&a._exitPrereqs.value)}),l.allowed=!0,a.forEach(function(a){d.cancelled||(d.currentState=a,a.enter(c,a._enterPrereqs&&a._enterPrereqs.value))}),l.allowed=!1}function f(a,b,c,d){var e,f,g;if(c)[a].concat(a.parents).reverse().forEach(function(a){if(!e)for(g in d)if(a.params[g]||a.queryParams[g]){e=a;break}});else for(var h=0;h<a.parents.length;h++)if(f=a.parents[h],b.parents.indexOf(f)>-1){e=f;break}return e}function g(a,b,c){var d=a.parents,e=Math.min(d.length,d.indexOf(b)+(c?1:0));return[a].concat(d.slice(0,e))}function h(a,b,c){var d=!b||c;return g(a,b||a.root,d)}function i(a,b){return{message:a,isTransitionError:!0,toString:function(){return k.makeMessage("{0} (cause: {1})",a,b)}}}var j=a("when"),k=a("./util"),l=c.asyncPromises=function(){function a(a){if(!c.allowed)throw new Error("Async can only be called from within state.enter()");var b=j.defer();return d.push(b),j(a).then(function(a){d.indexOf(b)>-1&&b.resolve(a)},function(a){d.indexOf(b)>-1&&b.reject(a)}),b.promise}function b(){d.length=0}var c,d=[];return c={register:a,newTransitionStarted:b,allowed:!1}}();b.exports=c},{"./util":11,when:4}],9:[function(a,b){"use strict";function c(a){a=a||window.event;var b="defaultPrevented"in a?a.defaultPrevented:a.returnValue===!1;if(!(b||a.metaKey||a.ctrlKey)&&d(a)){var c=a.target||a.srcElement,f=e(c);if(f){var h=f.getAttribute("href");"#"!=h.charAt(0)&&"_blank"!=f.getAttribute("target")&&g(f)&&(a.preventDefault?a.preventDefault():a.returnValue=!1,i.state(h))}}}function d(a){a=a||window.event;var b=void 0!==a.which?a.which:h;return 1==b}function e(a){for(;a;){if("A"==a.nodeName)return a;a=a.parentNode}}function f(a){h=(a||window.event).button}function g(a){var b=a.hostname,c=a.port;if(!b){var d=document.createElement("a");d.href=a.href,b=d.hostname,c=d.port}var e=b==location.hostname,f=(c||"80")==(location.port||"80");return e&&f}var h,i;b.exports=function(a){i=a,document.addEventListener?document.addEventListener("click",c):(document.attachEvent("onmousedown",f),document.attachEvent("onclick",c))}},{}],10:[function(a,b){"use strict";var c={Router:a("./Router"),State:a("./State"),Async:a("./Transition").asyncPromises.register,util:a("./util")};b.exports=c},{"./Router":5,"./State":6,"./Transition":8,"./util":11}],11:[function(a,b){"use strict";function c(a){return"[object String]"==Object.prototype.toString.call(a)}function d(){}function e(a){return a.reduce(function(a,b){return a[b]=1,a},{})}function f(a){var b=[];for(var c in a)b.push(a[c]);return b}function g(a){var b={};for(var c in a)b[c]=a[c];return b}function h(a,b){for(var c in b)a[c]=b[c]}function i(a){var b=0;for(var c in a)b++;return b}function j(){for(var a=arguments[0],b=Array.prototype.slice.call(arguments,1),c=0,d=b.length;d>c;c++)a=a.replace("{"+c+"}",b[c]);return a}function k(a){return"/"+a.replace(l,"").replace(m,"$1").replace(n,"?")}var l=/^\/+/,m=/^([^?]*?)\/+$/,n=/\/+\?/;b.exports={isString:c,noop:d,arrayToObject:e,objectToArray:f,copyObject:g,mergeObjects:h,objectSize:i,makeMessage:j,normalizePathQuery:k}},{}]},{},[10])(10)});