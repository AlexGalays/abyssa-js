!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.Abyssa=t()}}(function(){return function t(e,n,r){function i(o,s){if(!n[o]){if(!e[o]){var u="function"==typeof require&&require;if(!s&&u)return u(o,!0);if(a)return a(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var c=n[o]={exports:{}};e[o][0].call(c.exports,function(t){var n=e[o][1][t];return i(n?n:t)},c,c.exports,t,e,n,r)}return n[o].exports}for(var a="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(t,e,n){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(t){return"function"==typeof t}function a(t){return"number"==typeof t}function o(t){return"object"==typeof t&&null!==t}function s(t){return void 0===t}e.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(t){if(!a(t)||0>t||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},r.prototype.emit=function(t){var e,n,r,a,u,f;if(this._events||(this._events={}),"error"===t&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if(e=arguments[1],e instanceof Error)throw e;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[t],s(n))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(r=arguments.length,a=new Array(r-1),u=1;r>u;u++)a[u-1]=arguments[u];n.apply(this,a)}else if(o(n)){for(r=arguments.length,a=new Array(r-1),u=1;r>u;u++)a[u-1]=arguments[u];for(f=n.slice(),r=f.length,u=0;r>u;u++)f[u].apply(this,a)}return!0},r.prototype.addListener=function(t,e){var n;if(!i(e))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,i(e.listener)?e.listener:e),this._events[t]?o(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,o(this._events[t])&&!this._events[t].warned){var n;n=s(this._maxListeners)?r.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[t].length>n&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace())}return this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(t,e){function n(){this.removeListener(t,n),r||(r=!0,e.apply(this,arguments))}if(!i(e))throw TypeError("listener must be a function");var r=!1;return n.listener=e,this.on(t,n),this},r.prototype.removeListener=function(t,e){var n,r,a,s;if(!i(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(n=this._events[t],a=n.length,r=-1,n===e||i(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(o(n)){for(s=a;s-->0;)if(n[s]===e||n[s].listener&&n[s].listener===e){r=s;break}if(0>r)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},r.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[t],i(n))this.removeListener(t,n);else for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},r.prototype.listeners=function(t){var e;return e=this._events&&this._events[t]?i(this._events[t])?[this._events[t]]:this._events[t].slice():[]},r.listenerCount=function(t,e){var n;return n=t._events&&t._events[e]?i(t._events[e])?1:t._events[e].length:0}},{}],2:[function(t,e,n){"use strict";function r(t){function e(t,e,r){var i=$?o($.currentState,$.toParams):V,a=o(t,e),f=u.objectDiff(i&&i.params,e);return m(i,a,f)?void($&&$.exiting&&n()):($&&n(),W=V,V=a,nt=f,$=s(i,a,f,r,l),h(i,a),$&&$.run(),$&&($.cancelled?V=i:p(i,a)),void($=null))}function n(){l.log("Cancelling existing transition from {0} to {1}",$.from,$.to),$.cancel(),Z=!1}function h(t,e){l.log("Starting transition from {0} to {1}",t,e);var n=t?t.asPublic:null,r=e.asPublic;X.transition.emit("started",r,n)}function p(t,e){B||Z||(l.log("Updating URL: {0}",K),v(K,document.title,K)),Z=!1,l.log("Transition from {0} to {1} ended",t,e),e.state.lastParams=e.params;var n=t?t.asPublic:null,r=e.asPublic;X.transition.emit("ended",r,n)}function v(t,e,n){D()?(et=!0,location.hash=tt.hashPrefix+n):history.pushState(t,e,n)}function m(t,e,n){return t?e.state==t.state&&0==Object.keys(n.all).length:!1}function d(t){if(l.log("State not found: {0}",t),tt.notFound)return e(J[tt.notFound],{});throw new Error('State "'+t+'" could not be found')}function g(t){return u.mergeObjects(tt,t),X}function y(t,e){return tt.enableLogs&&r.enableLogs(),tt.interceptAnchors&&a(X),H="#"+tt.hashPrefix+"/",l.log("Router init"),w(),I(),t=void 0!==t?t:N(),l.log("Initializing to state {0}",t||'""'),A(t,e),b(),G=!0,X}function _(){window.onhashchange=null,window.onpopstate=null}function b(){function t(t){if(et)return void(et=!1);var e=t.state||N();l.log("URL changed: {0}",e),B=!0,S(e)}window[D()?"onhashchange":"onpopstate"]=t}function w(){var t=u.objectToArray(Y);L(t),j(function(t,e){e.init(X,t)}),x(t),J=E(t,{}),P()}function x(t){var e={};t.forEach(function(n){if(e[n.path]){var r=t.map(function(t){return t.fullPath()||"empty"});throw new Error("Two sibling states have the same path ("+r+")")}e[n.path]=1,x(n.children)})}function P(){var t={};for(var e in J){var n=u.normalizePathQuery(J[e].fullPath());if(t[n])throw new Error("Ambiguous state paths: "+n);t[n]=1}}function L(t){t.forEach(function(t){var e=u.objectToArray(t.states);if(e.length){L(e);var n=e.reduce(function(t,e){return""==e.path||t},!1);if(n)return;var r=f({uri:""});t.states._default_=r}})}function j(t){for(var e in Y)t(e,Y[e])}function E(t,e){return t.reduce(function(t,e){return e.children.length?E(e.children,t):(t[e.fullName]=e,e.paths=u.parsePaths(e.fullPath()),t)},e)}function A(t){var e=J[t],n=(e?arguments[1]:null)||{},r=e?arguments[2]:arguments[1];l.log("Changing state to {0}",t||'""'),B=!1,e?O(e,n,r):S(t,r)}function T(t,e,n){var r=J[t].lastParams||e;A(t,r,n)}function S(t,n){var r,i,a,o;K=u.normalizePathQuery(t);var s=K.split("?"),f=s[0],c=s[1],l=u.parsePaths(f),h=u.parseQueryParams(c);for(var p in J)if(a=J[p],o=a.matches(l)){r=a,i=u.mergeObjects(o,h);break}r?e(r,i,n):d(K)}function O(t,e,n){var r=J[t];if(!r)return d(t);var i=Q(r,e);S(i,n)}function k(t,e){if(Y[t])throw new Error("A state already exist in the router with the name "+t);return e=F(e),Y[t]=e,G&&(e.init(X,t),E({_:e})),X}function N(){var t,e=location.href.indexOf(H);return t=e>-1?location.href.slice(e+H.length):D()?"/":(location.pathname+location.search).slice(1),u.normalizePathQuery(t)}function D(){return"hash"==tt.urlSync}function U(t,e){var n=J[t];if(!n)throw new Error("Cannot find state "+t);var r=Q(n,e);return u.normalizePathQuery(r)}function Q(t,e){var n={};for(var r in e)n[r]=encodeURIComponent(e[r]);return t.interpolate(n)}function R(){return V&&V.asPublic}function C(){return W&&W.asPublic}function M(){return nt}function q(){return null==W}function z(t){return u.mapValues(t,F)}function F(t){return t.children&&(t.children=z(t.children)),f(t)}function I(){if(l.enabled){var t=function(t){return 0==t?"":new Array(2+4*(t-1)).join(" ")+"── "},e=function r(e){var n=u.normalizePathQuery(e.fullPath()),i=0==e.children.length?" (@ path)".replace("path",n):"",a=t(e.parents.length)+e.name+i+"\n";return a+e.children.map(r).join("")},n="\nState tree\n\n";n+=u.objectToArray(Y).map(e).join(""),n+="\n",l.log(n)}}var K,V,W,$,J,B,G,H,X={},Y=z(t),Z=!0,tt={enableLogs:!1,interceptAnchors:!0,notFound:null,urlSync:!0,hashPrefix:""},et=!1,nt={};return X.configure=g,X.init=y,X.transitionTo=A,X.backTo=T,X.addState=k,X.link=U,X.current=R,X.previous=C,X.isFirstTransition=q,X.paramsDiff=M,X.transition=new i,X.urlPathQuery=N,X.terminate=_,u.mergeObjects(c,X),X}var i=t("events"),a=t("./anchors"),o=t("./StateWithParams"),s=t("./Transition"),u=t("./util"),f=t("./State"),c=t("./api"),l={log:u.noop,error:u.noop,enabled:!1};r.enableLogs=function(){l.enabled=!0,l.log=function(){for(var t=arguments.length,e=Array(t),n=0;t>n;n++)e[n]=arguments[n];var r=u.makeMessage.apply(null,e);console.log(r)},l.error=function(){for(var t=arguments.length,e=Array(t),n=0;t>n;n++)e[n]=arguments[n];var r=u.makeMessage.apply(null,e);console.error(r)}},e.exports=r},{"./State":3,"./StateWithParams":4,"./Transition":5,"./anchors":6,"./api":7,"./util":10,events:1}],3:[function(t,e,n){"use strict";function r(t){function e(t,e,n){g.router=t,g.name=e,g.isDefault="_default_"==e,g.parent=n,g.parents=r(),g.root=g.parent?g.parents[g.parents.length-1]:g,g.children=u.objectToArray(y),g.fullName=c(),p(function(e,n){n.init(t,e,g)})}function n(){for(var t=g.path,e=g.parent;e;)e.path&&(t=e.path+"/"+t),e=e.parent;return t}function r(){for(var t=[],e=g.parent;e;)t.push(e),e=e.parent;return t}function c(){var t=g.parents.reduceRight(function(t,e){return t+e.name+"."},"")+g.name;return g.isDefault?t.replace("._default_",""):t}function l(){return g.parents.reduce(function(t,e){return u.mergeObjects(t,e.queryParams)},u.copyObject(g.queryParams))}function h(t,e){if(void 0!==e)return g.ownData[t]=e,g;for(var n=g;void 0===n.ownData[t]&&n.parent;)n=n.parent;return n.ownData[t]}function p(t){for(var e in y)t(e,y[e])}function v(t){var e={},n=g.paths.filter(function(t){return"*"!=t[t.length-1]});if(n.length>t.length)return!1;for(var r=0;r<t.length;r++){var a=t[r],o=g.paths[r];if(!o)return!1;var s="*"==o[o.length-1];if(s){var u=i(o);return e[u]=t.slice(r).join("/"),e}var f=":"==o[0];if(f){var u=i(o);e[u]=a}else if(o!=a)return!1}return e}function m(t){var e=g.fullPath().replace(f,function(e){return t[i(e)]||""}),n=l(),r=Object.keys(t).filter(function(t){return n[t]}),a=r.map(function(e){return e+"="+t[e]}).join("&");return e+(a.length?"?"+a:"")}function d(){return g.fullName}var g={},y=t.children;return g.path=a(t.uri),g.params=o(t.uri),g.queryParams=s(t.uri),g.states=y,g.enter=t.enter||u.noop,g.update=t.update,g.exit=t.exit||u.noop,g.ownData=t.data||{},g.init=e,g.fullPath=n,g.allQueryParams=l,g.matches=v,g.interpolate=m,g.data=h,g.toString=d,g}function i(t){return"*"==t[t.length-1]?t.substr(1).slice(0,-1):t.substr(1)}function a(t){return(t||"").split("?")[0]}function o(t){var e=f.exec(t);return e?u.arrayToObject(e.map(i)):{}}function s(t){var e=(t||"").split("?")[1];return e?u.arrayToObject(e.split("&")):{}}var u=t("./util"),f=/:[^\\?\/]*/g;e.exports=r},{"./util":10}],4:[function(t,e,n){"use strict";function r(t,e,n){return{state:t,params:e,toString:a,asPublic:i(t,e,n)}}function i(t,e,n){function r(e){for(var n=t;n;){if(n.fullName==e)return!0;n=n.parent}return!1}return{uri:n,params:e,name:t?t.name:"",fullName:t?t.fullName:"",data:t?t.data:null,isIn:r}}function a(){var t=this.state&&this.state.fullName;return t+":"+JSON.stringify(this.params)}e.exports=r},{}],5:[function(t,e,n){"use strict";function r(t,e,n,r,a){function u(){i(l,h,m,g,d,r,a)}function f(){g.cancelled=!0}var c,l,h,p=t&&t.state,v=e.state,m=e.params,d=p==v,g={from:p,to:v,toParams:m,cancel:f,cancelled:!1,currentState:p,run:u};p&&(c=o(p,v,d,n));var y=!c||d;return h=p?s(p,c,y):[],l=s(v,c,y).reverse(),g}function i(t,e,n,r,i,o,s){o=o||{},r.exiting=!0,e.forEach(function(t){i&&t.update||a(t,"exit",n,r,o,s)}),r.exiting=!1,t.forEach(function(t){var e=i&&t.update?"update":"enter";a(t,e,n,r,o,s)})}function a(t,e,n,r,i,a){if(!r.cancelled){if(a.enabled){var o=e[0].toUpperCase()+e.slice(1);a.log(o+" "+t.fullName)}var s=t[e](n,i,t.fullName);if(!r.cancelled)return r.currentState="exit"==e?t.parent:t,s}}function o(t,e,n,r){var i,a,o;if(n)[t].concat(t.parents).reverse().forEach(function(t){if(!i)for(o in r.all)if(t.params[o]||t.queryParams[o]){i=t;break}});else for(var s=0;s<t.parents.length;s++)if(a=t.parents[s],e.parents.indexOf(a)>-1){i=a;break}return i}function s(t,e,n){e=e||t.root;var r=t.parents,i=Math.min(r.length,r.indexOf(e)+(n?1:0));return[t].concat(r.slice(0,i))}e.exports=r},{}],6:[function(t,e,n){"use strict";function r(t){var e=a(t);void 0!==e&&f.transitionTo(e)}function i(t){var e=a(t);void 0!==e&&(t.preventDefault(),f.transitionTo(e))}function a(t){if(!(t.defaultPrevented||t.metaKey||t.ctrlKey)&&o(t)){var e=t.target,n=s(e);if(n){var r=n.getAttribute("data-nav");if("ignore"!=r&&("mousedown"!=t.type||"mousedown"==r)){var i=n.getAttribute("href");if(i&&"#"!=i.charAt(0)&&"_blank"!=n.getAttribute("target")&&u(n))return"click"==t.type&&"mousedown"==r?void t.preventDefault():i}}}}function o(t){return 1==t.which}function s(t){for(;t;){if("A"==t.nodeName)return t;t=t.parentNode}}function u(t){var e=t.hostname,n=t.port;if(!e){var r=document.createElement("a");r.href=t.href,e=r.hostname,n=r.port}var i=e==location.hostname,a=(n||"80")==(location.port||"80");return i&&a}var f;e.exports=function(t){f=t,document.addEventListener("mousedown",r),document.addEventListener("click",i)}},{}],7:[function(t,e,n){"use strict";e.exports={}},{}],8:[function(t,e,n){"use strict";function r(t){var e=r.Promise||Promise,n=!0;i.transition.once("started",function(){n=!1});var a=new e(function(e,r){t.then(function(t){n&&e(t)},function(t){n&&r(t)})});return a}var i=t("./api");e.exports=r},{"./api":7}],9:[function(t,e,n){"use strict";var r=t("./util"),i={Router:t("./Router"),api:t("./api"),async:t("./async"),State:r.stateShorthand,_util:r};e.exports=i},{"./Router":2,"./api":7,"./async":8,"./util":10}],10:[function(t,e,n){"use strict";var r={};r.noop=function(){},r.arrayToObject=function(t){return t.reduce(function(t,e){return t[e]=1,t},{})},r.objectToArray=function(t){var e=[];for(var n in t)e.push(t[n]);return e},r.copyObject=function(t){var e={};for(var n in t)e[n]=t[n];return e},r.mergeObjects=function(t,e){for(var n in e)t[n]=e[n];return t},r.mapValues=function(t,e){var n={};for(var r in t)n[r]=e(t[r]);return n},r.objectDiff=function(t,e){var n,r={},i={},a={},o={},t=t||{};for(n in t)n in e?t[n]!=e[n]&&(r[n]=o[n]=!0):a[n]=o[n]=!0;for(n in e)n in t||(i[n]=o[n]=!0);return{all:o,update:r,enter:i,exit:a}},r.makeMessage=function(){for(var t=arguments[0],e=Array.prototype.slice.call(arguments,1),n=0,r=e.length;r>n;n++)t=t.replace("{"+n+"}",e[n]);return t},r.parsePaths=function(t){return t.split("/").filter(function(t){return t.length}).map(function(t){return decodeURIComponent(t)})},r.parseQueryParams=function(t){return t?t.split("&").reduce(function(t,e){var n=e.split("=");return t[n[0]]=decodeURIComponent(n[1]),t},{}):{}};var i=/^\/+/,a=/^([^?]*?)\/+$/,o=/\/+\?/;r.normalizePathQuery=function(t){return"/"+t.replace(i,"").replace(a,"$1").replace(o,"?")},r.stateShorthand=function(t,e,n){return r.mergeObjects({uri:t,children:n||{}},e)},e.exports=r},{}]},{},[9])(9)});
