/* abyssa 2.0.4 - A stateful router library for single page applications */

!function(a){"object"==typeof exports?module.exports=a():"function"==typeof define&&define.amd?define(a):"undefined"!=typeof window?window.Abyssa=a():"undefined"!=typeof global?global.Abyssa=a():"undefined"!=typeof self&&(self.Abyssa=a())}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(){},{}],2:[function(a,b){"use strict";function c(a){function b(a,b){if(!r(a,b)){var c,d=g(a,b);L?(l(),c=g(L.currentState,L.toParams)):c=K,K=d,K._pathQuery=J,O&&p(c._pathQuery,document.title,c._pathQuery),m(c,d),L=h(c,d,s(c&&c.params,b)),L.then(function(){L=null,O||T||(j("Pushing state: {0}",J),q(J,document.title,J)),O&&p(K._pathQuery,document.title,K._pathQuery),n(c,d)},function(a){L=null,K=c,o(c,d,a)}).otherwise(k)}}function l(){j("Cancelling existing transition from {0} to {1}",L.from,L.to),L.cancel(),T=!1,Q.transition.cancelled.dispatch(L.to,L.from)}function m(a,b){j("Starting transition from {0} to {1}",a,b),Q.transition.started.dispatch(b,a)}function n(a,b){j("Transition from {0} to {1} completed",a,b),T=!1,Q.transition.completed.dispatch(b,a)}function o(a,b,c){k("Transition from {0} to {1} failed: {2}",a,b,c),Q.transition.failed.dispatch(b,a)}function p(a,b,c){history.emulate&&(V=!0),history.replaceState(a,b,c)}function q(a,b,c){history.emulate&&(V=!0),history.pushState(a,b,c)}function r(a,b){var c,d,e;return L?(c=L.to,d=L.toParams):K&&(c=K._state,d=K.params),e=s(d,b),a==c&&0==i.objectSize(e)}function s(a,b){var c={},a=a||{};for(var d in a)a[d]!=b[d]&&(c[d]=1);for(var d in b)a[d]!=b[d]&&(c[d]=1);return c}function t(a){if(j("State not found: {0}",a),!U.notFound)throw new Error('State "'+a+'" could not be found');b(U.notFound)}function u(a){return i.mergeObjects(U,a),Q}function v(a,b){return U.enableLogs&&c.enableLogs(),U.interceptAnchorClicks&&f(Q),j("Router init"),w(),a=void 0!==a?a:E(),j("Initializing to state {0}",a||'""'),z(a,b),window.onpopstate=function(a){if(V)return V=!1,void 0;var b=a.state||E();j("Popped state: {0}",b),O=!0,B(b)},P=!0,Q}function w(){x(function(a,b){b.init(a)}),U.notFound&&U.notFound.init("notFound"),M={},y(function(a){M[a.fullName]=a,a.route=S.addRoute(a.fullPath()+":?query:"),a.route.matched.add(function(){N=!0,b(a,F(a,arguments))})})}function x(a){for(var b in R)a(b,R[b])}function y(a){function b(c){c.forEach(function(c){c.children.length?b(c.children):a(c)})}b(i.objectToArray(R))}function z(a,b){var c=void 0!==M[a];j("Changing state to {0}",a||'""'),O=!1,c?C(a,b||{}):B(a)}function A(a,b){j("Redirecting..."),z(a,b)}function B(a){J=i.normalizePathQuery(a),N=!1,S.parse(J),N||t(J)}function C(a,b){var c=M[a];if(!c)return t(a);var d=c.route.interpolate(b);B(d)}function D(a,b){if(P)throw new Error("States can only be added before the Router is initialized");if(R[a])throw new Error("A state already exist in the router with the name "+a);return j("Adding state {0}",a),R[a]=b,Q}function E(){var a=location.href.indexOf("#/"),b=a>-1?location.href.slice(a+2):(location.pathname+location.search).slice(1);return i.normalizePathQuery(b)}function F(a,b){var c,d=Array.prototype.slice.apply(b),e=d.pop(),f={};a.fullPath().replace(/\{\w*\}/g,function(a){return c=a.slice(1,-1),f[c]=d.shift(),""}),e&&i.mergeObjects(f,e);for(var g in f)i.isString(f[g])&&(f[g]=decodeURIComponent(f[g]));return f}function G(a,b){var c={},d={},e=!1,f=M[a];if(!f)throw new Error("Cannot find state "+a);[f].concat(f.parents).forEach(function(a){i.mergeObjects(d,a.queryParams)});for(var g in b)d[g]&&(c[g]=b[g],delete b[g],e=!0);return e&&(b.query=c),i.normalizePathQuery(f.route.interpolate(b))}function H(){return K}function I(a,b){Q.transition.ended.dispatch(a,b)}var J,K,L,M,N,O,P,Q={},R=i.copyObject(a),S=e.create(),T=!0,U={enableLogs:!1,interceptAnchorClicks:!0},V=!1;return S.shouldTypecast=!0,S.ignoreState=!0,Q.configure=u,Q.init=v,Q.state=z,Q.redirect=A,Q.addState=D,Q.link=G,Q.currentState=H,Q.transition={started:new d,ended:new d,completed:new d,failed:new d,cancelled:new d},Q.initialized=new d,Q.changed=Q.transition.completed,Q.transition.completed.addOnce(function(){Q.initialized.dispatch()}),Q.transition.completed.add(I),Q.transition.failed.add(I),Q.transition.cancelled.add(I),Q}var d=a("signals").Signal,e=a("crossroads"),f=a("./anchorClicks"),g=a("./StateWithParams"),h=a("./Transition"),i=a("./util"),j=i.noop,k=i.noop;c.enableLogs=function(){function a(a){for(var b=a[0],c=Array.prototype.slice.call(a,1),d=0,e=c.length;e>d;d++)b=b.replace("{"+d+"}",c[d]);return b}j=function(){console.log(a(arguments))},k=function(){console.error(a(arguments))}},b.exports=c},{"./StateWithParams":4,"./Transition":5,"./anchorClicks":6,"./util":8,crossroads:1,signals:1}],3:[function(a,b){"use strict";function c(){function a(a,b){p.name=a,p.parent=b,p.parents=c(),p.children=g(),p.fullName=i(),p.root=p.parents[p.parents.length-1],p.async=f,l(function(a,b){b.init(a,p)}),o=!0}function b(){for(var a=p.path,b=p.parent;b;)b.path&&(a=b.path+"/"+a),b=b.parent;return a}function c(){for(var a=[],b=p.parent;b;)a.push(b),b=b.parent;return a}function g(){var a=[];for(var b in s)a.push(s[b]);return a}function h(a){var b={};for(var c in a)a[c]._isState&&(b[c]=a[c]);return b}function i(){return p.parents.reduceRight(function(a,b){return a+b.name+"."},"")+p.name}function j(a){var b={enter:1,exit:1,enterPrereqs:1,exitPrereqs:1},c={};for(var d in a)b[d]||a[d]._isState||(c[d]=a[d]);return c}function k(a,b){if(void 0!==b){if(void 0!==p.ownData[a])throw new Error("State "+p.fullName+" already has data with the key "+a);return p.ownData[a]=b,p}for(var c=p;void 0===c.ownData[a]&&c.parent;)c=c.parent;return c.ownData[a]}function l(a){for(var b in s)a(b,s[b])}function m(a,b){if(o)throw new Error("States can only be added before the Router is initialized");if(s[a])throw new Error("The state {0} already has a child state named {1}".replace("{0}",p.name).replace("{1}",a));return s[a]=b,p}function n(){return p.fullName}var o,p={_isState:!0},q=d(arguments),r=q.options,s=h(q.options);return p.path=q.path,p.params=q.params,p.queryParams=q.queryParams,p.states=s,p.enter=r.enter||e.noop,p.exit=r.exit||e.noop,p.enterPrereqs=r.enterPrereqs,p.exitPrereqs=r.exitPrereqs,p.ownData=j(r),p.init=a,p.fullPath=b,p.data=k,p.addState=m,p.toString=n,p}function d(a){var b,c,d={path:"",options:{},params:{},queryParams:{}},f=a[0],g=a[1];return 1==a.length?e.isString(f)?d.path=f:d.options=f:2==a.length&&(d.path=f,d.options="object"==typeof g?g:{enter:g}),b=d.path.indexOf("?"),-1!=b&&(d.queryParams=d.path.slice(b+1),d.path=d.path.slice(0,b),d.queryParams=e.arrayToObject(d.queryParams.split("&"))),d.path=d.path.replace(/:\w*/g,function(a){return c=a.substring(1),d.params[c]=1,"{"+c+"}"}),d}var e=a("./util"),f=a("./Transition").asyncPromises.register;b.exports=c},{"./Transition":5,"./util":8}],4:[function(a,b){"use strict";function c(a,b){return{_state:a,name:a&&a.name,fullName:a&&a.fullName,data:a&&a.data,params:b,is:d,isIn:e,toString:f}}function d(a){return this.fullName==a}function e(a){for(var b=this._state;b;){if(b.fullName==a)return!0;b=b.parent}return!1}function f(){return this.fullName+":"+JSON.stringify(this.params)}b.exports=c},{}],5:[function(a,b){"use strict";function c(a,b,c){function g(a,b){return n.then(function(){l||a()},function(a){l||b(a)})}function i(){l=t.cancelled=!0}var k,l,m,n,o=[],p=a&&a._state,q=b._state,r=b.params,s=p==q,t={from:p,to:q,toParams:r,then:g,cancel:i,cancelled:l,currentState:p};return p&&(k=f(p,q,s,c),o=h(p,k,s)),m=h(q,k,s).reverse(),n=d(m,o,r).then(function(){l||e(m,o,r,t)}),j.newTransitionStarted(),t}function d(a,b,c){return b.forEach(function(a){if(a.exitPrereqs)var b=a._exitPrereqs=i(a.exitPrereqs()).then(function(c){a._exitPrereqs==b&&(a._exitPrereqs.value=c)},function(){throw new Error("Failed to resolve EXIT prereqs of "+a.fullName)})}),a.forEach(function(a){if(a.enterPrereqs)var b=a._enterPrereqs=i(a.enterPrereqs(c)).then(function(c){a._enterPrereqs==b&&(a._enterPrereqs.value=c)},function(){throw new Error("Failed to resolve ENTER prereqs of "+a.fullName)})}),i.all(a.concat(b).map(function(a){return a._enterPrereqs||a._exitPrereqs}))}function e(a,b,c,d){b.forEach(function(a){a.exit(a._exitPrereqs&&a._exitPrereqs.value)}),j.allowed=!0,a.forEach(function(a){d.cancelled||(d.currentState=a,a.enter(c,a._enterPrereqs&&a._enterPrereqs.value))}),j.allowed=!1}function f(a,b,c,d){var e,f,g;if(c)[a].concat(a.parents).reverse().forEach(function(a){if(!e)for(g in d)if(a.params[g]||a.queryParams[g]){e=a;break}});else for(var h=0;h<a.parents.length;h++)if(f=a.parents[h],b.parents.indexOf(f)>-1){e=f;break}return e}function g(a,b,c){var d=a.parents,e=Math.min(d.length,d.indexOf(b)+(c?1:0));return[a].concat(d.slice(0,e))}function h(a,b,c){var d=!b||c;return g(a,b||a.root,d)}var i=a("when"),j=c.asyncPromises=function(){function a(a){if(!c.allowed)throw new Error("Async can only be called from within state.enter()");var b=i.defer();return d.push(b),i(a).then(function(a){d.indexOf(b)>-1&&b.resolve(a)},function(a){d.indexOf(b)>-1&&b.reject(a)}),b.promise}function b(){d.length=0}var c,d=[];return c={register:a,newTransitionStarted:b,allowed:!1}}();b.exports=c},{when:1}],6:[function(a,b){"use strict";function c(a){a=a||window.event;var b="defaultPrevented"in a?a.defaultPrevented:a.returnValue===!1;if(!(b||a.metaKey||a.ctrlKey)&&d(a)){var c=a.target||a.srcElement,f=e(c);if(f){var h=f.getAttribute("href");"#"!=h.charAt(0)&&"_blank"!=f.getAttribute("target")&&g(f)&&(a.preventDefault?a.preventDefault():a.returnValue=!1,i.state(h))}}}function d(a){a=a||window.event;var b=void 0!==a.which?a.which:h;return 1==b}function e(a){for(;a;){if("A"==a.nodeName)return a;a=a.parentNode}}function f(a){h=(a||window.event).button}function g(a){var b=a.hostname,c=a.port;if(!b){var d=document.createElement("a");d.href=a.href,b=d.hostname,c=d.port}var e=b==location.hostname,f=(c||"80")==(location.port||"80");return e&&f}var h,i;b.exports=function(a){i=a,document.addEventListener?document.addEventListener("click",c):(document.attachEvent("onmousedown",f),document.attachEvent("onclick",c))}},{}],7:[function(a,b){"use strict";a("html5-history-api/history.iegte8");var c={Router:a("./Router"),State:a("./State"),Async:a("./Transition").asyncPromises.register,util:a("./util")};b.exports=c},{"./Router":2,"./State":3,"./Transition":5,"./util":8,"html5-history-api/history.iegte8":1}],8:[function(a,b){"use strict";function c(a){return"[object String]"==Object.prototype.toString.call(a)}function d(){}function e(a){return a.reduce(function(a,b){return a[b]=1,a},{})}function f(a){var b=[];for(var c in a)b.push(a[c]);return b}function g(a){var b={};for(var c in a)b[c]=a[c];return b}function h(a,b){for(var c in b)a[c]=b[c]}function i(a){var b=0;for(var c in a)b++;return b}function j(a){return"/"+a.replace(k,"").replace(l,"$1").replace(m,"?")}var k=/^\/+/,l=/^([^?]*?)\/+$/,m=/\/+\?/;b.exports={isString:c,noop:d,arrayToObject:e,objectToArray:f,copyObject:g,mergeObjects:h,objectSize:i,normalizePathQuery:j}},{}]},{},[7])(7)});