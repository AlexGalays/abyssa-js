/** @license
 * JS Signals <http://millermedeiros.github.com/js-signals/>
 * Released under the MIT license
 * Author: Miller Medeiros
 * Version: 1.0.0 - Build: 268 (2012/11/29 05:48 PM)
 */
!function(t){function e(t,e,n,r,i){this._listener=e,this._isOnce=n,this.context=r,this._signal=t,this._priority=i||0}function n(t,e){if("function"!=typeof t)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",e))}function r(){this._bindings=[],this._prevParams=null;var t=this;this.dispatch=function(){r.prototype.dispatch.apply(t,arguments)}}e.prototype={active:!0,params:null,execute:function(t){var e,n;return this.active&&this._listener&&(n=this.params?this.params.concat(t):t,e=this._listener.apply(this.context,n),this._isOnce&&this.detach()),e},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},r.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(t,n,r,i){var o,a=this._indexOfListener(t,r);if(-1!==a){if(o=this._bindings[a],o.isOnce()!==n)throw new Error("You cannot add"+(n?"":"Once")+"() then add"+(n?"Once":"")+"() the same listener without removing the relationship first.")}else o=new e(this,t,n,r,i),this._addBinding(o);return this.memorize&&this._prevParams&&o.execute(this._prevParams),o},_addBinding:function(t){var e=this._bindings.length;do--e;while(this._bindings[e]&&t._priority<=this._bindings[e]._priority);this._bindings.splice(e+1,0,t)},_indexOfListener:function(t,e){for(var n,r=this._bindings.length;r--;)if(n=this._bindings[r],n._listener===t&&n.context===e)return r;return-1},has:function(t,e){return-1!==this._indexOfListener(t,e)},add:function(t,e,r){return n(t,"add"),this._registerListener(t,!1,e,r)},addOnce:function(t,e,r){return n(t,"addOnce"),this._registerListener(t,!0,e,r)},remove:function(t,e){n(t,"remove");var r=this._indexOfListener(t,e);return-1!==r&&(this._bindings[r]._destroy(),this._bindings.splice(r,1)),t},removeAll:function(){for(var t=this._bindings.length;t--;)this._bindings[t]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active){var t,e=Array.prototype.slice.call(arguments),n=this._bindings.length;if(this.memorize&&(this._prevParams=e),n){t=this._bindings.slice(),this._shouldPropagate=!0;do n--;while(t[n]&&this._shouldPropagate&&t[n].execute(e)!==!1)}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var i=r;i.Signal=r,"function"==typeof define&&define.amd?define(function(){return i}):"undefined"!=typeof module&&module.exports?module.exports=i:t.signals=i}(this),/** @license
 * crossroads <http://millermedeiros.github.com/crossroads.js/>
 * Author: Miller Medeiros | MIT License
 * v0.12.0 (2013/01/21 13:47)
 */
function(){var t=function(t){function e(t,e){if(t.indexOf)return t.indexOf(e);for(var n=t.length;n--;)if(t[n]===e)return n;return-1}function n(t,n){var r=e(t,n);-1!==r&&t.splice(r,1)}function r(t,e){return"[object "+e+"]"===Object.prototype.toString.call(t)}function i(t){return r(t,"RegExp")}function o(t){return r(t,"Array")}function a(t){return"function"==typeof t}function s(t){var e;return e=null===t||"null"===t?null:"true"===t?!0:"false"===t?!1:t===d||"undefined"===t?d:""===t||isNaN(t)?t:parseFloat(t)}function u(t){for(var e=t.length,n=[];e--;)n[e]=s(t[e]);return n}function c(t,e){for(var n,r,i=(t||"").replace("?","").split("&"),o=i.length,a={};o--;)n=i[o].split("="),r=e?s(n[1]):n[1],a[n[0]]="string"==typeof r?decodeURIComponent(r):r;return a}function f(){this.bypassed=new t.Signal,this.routed=new t.Signal,this._routes=[],this._prevRoutes=[],this._piped=[],this.resetState()}function h(e,n,r,o){var a=i(e),s=o.patternLexer;this._router=o,this._pattern=e,this._paramsIds=a?null:s.getParamIds(e),this._optionalParamsIds=a?null:s.getOptionalParamsIds(e),this._matchRegexp=a?e:s.compilePattern(e,o.ignoreCase),this.matched=new t.Signal,this.switched=new t.Signal,n&&this.matched.add(n),this._priority=r||0}var l,p,d;return p=""===/t(.+)?/.exec("t")[1],f.prototype={greedy:!1,greedyEnabled:!0,ignoreCase:!0,ignoreState:!1,shouldTypecast:!1,normalizeFn:null,resetState:function(){this._prevRoutes.length=0,this._prevMatchedRequest=null,this._prevBypassedRequest=null},create:function(){return new f},addRoute:function(t,e,n){var r=new h(t,e,n,this);return this._sortedInsert(r),r},removeRoute:function(t){n(this._routes,t),t._destroy()},removeAllRoutes:function(){for(var t=this.getNumRoutes();t--;)this._routes[t]._destroy();this._routes.length=0},parse:function(t,e){if(t=t||"",e=e||[],this.ignoreState||t!==this._prevMatchedRequest&&t!==this._prevBypassedRequest){var n,r=this._getMatchedRoutes(t),i=0,o=r.length;if(o)for(this._prevMatchedRequest=t,this._notifyPrevRoutes(r,t),this._prevRoutes=r;o>i;)n=r[i],n.route.matched.dispatch.apply(n.route.matched,e.concat(n.params)),n.isFirst=!i,this.routed.dispatch.apply(this.routed,e.concat([t,n])),i+=1;else this._prevBypassedRequest=t,this.bypassed.dispatch.apply(this.bypassed,e.concat([t]));this._pipeParse(t,e)}},_notifyPrevRoutes:function(t,e){for(var n,r=0;n=this._prevRoutes[r++];)n.route.switched&&this._didSwitch(n.route,t)&&n.route.switched.dispatch(e)},_didSwitch:function(t,e){for(var n,r=0;n=e[r++];)if(n.route===t)return!1;return!0},_pipeParse:function(t,e){for(var n,r=0;n=this._piped[r++];)n.parse(t,e)},getNumRoutes:function(){return this._routes.length},_sortedInsert:function(t){var e=this._routes,n=e.length;do--n;while(e[n]&&t._priority<=e[n]._priority);e.splice(n+1,0,t)},_getMatchedRoutes:function(t){for(var e,n=[],r=this._routes,i=r.length;(e=r[--i])&&((!n.length||this.greedy||e.greedy)&&e.match(t)&&n.push({route:e,params:e._getParamsArray(t)}),this.greedyEnabled||!n.length););return n},pipe:function(t){this._piped.push(t)},unpipe:function(t){n(this._piped,t)},toString:function(){return"[crossroads numRoutes:"+this.getNumRoutes()+"]"}},l=new f,l.VERSION="0.12.0",l.NORM_AS_ARRAY=function(t,e){return[e.vals_]},l.NORM_AS_OBJECT=function(t,e){return[e]},h.prototype={greedy:!1,rules:void 0,match:function(t){return t=t||"",this._matchRegexp.test(t)&&this._validateParams(t)},_validateParams:function(t){var e,n=this.rules,r=this._getParamsObject(t);for(e in n)if("normalize_"!==e&&n.hasOwnProperty(e)&&!this._isValidParam(t,e,r))return!1;return!0},_isValidParam:function(t,n,r){var s=this.rules[n],u=r[n],c=!1,f=0===n.indexOf("?");return null==u&&this._optionalParamsIds&&-1!==e(this._optionalParamsIds,n)?c=!0:i(s)?(f&&(u=r[n+"_"]),c=s.test(u)):o(s)?(f&&(u=r[n+"_"]),c=this._isValidArrayRule(s,u)):a(s)&&(c=s(u,t,r)),c},_isValidArrayRule:function(t,n){if(!this._router.ignoreCase)return-1!==e(t,n);"string"==typeof n&&(n=n.toLowerCase());for(var r,i,o=t.length;o--;)if(r=t[o],i="string"==typeof r?r.toLowerCase():r,i===n)return!0;return!1},_getParamsObject:function(t){for(var n,r,i=this._router.shouldTypecast,o=this._router.patternLexer.getParamValues(t,this._matchRegexp,i),a={},u=o.length;u--;)r=o[u],this._paramsIds&&(n=this._paramsIds[u],0===n.indexOf("?")&&r&&(a[n+"_"]=r,r=c(r,i),o[u]=r),p&&""===r&&-1!==e(this._optionalParamsIds,n)&&(r=void 0,o[u]=r),a[n]=r),a[u]=r;return a.request_=i?s(t):t,a.vals_=o,a},_getParamsArray:function(t){var e,n=this.rules?this.rules.normalize_:null;return n=n||this._router.normalizeFn,e=n&&a(n)?n(t,this._getParamsObject(t)):this._getParamsObject(t).vals_},interpolate:function(t){var e=this._router.patternLexer.interpolate(this._pattern,t);if(!this._validateParams(e))throw new Error("Generated string doesn't validate against `Route.rules`.");return e},dispose:function(){this._router.removeRoute(this)},_destroy:function(){this.matched.dispose(),this.switched.dispose(),this.matched=this.switched=this._pattern=this._matchRegexp=null},toString:function(){return'[Route pattern:"'+this._pattern+'", numListeners:'+this.matched.getNumListeners()+"]"}},f.prototype.patternLexer=function(){function t(){var t,e;for(t in p)p.hasOwnProperty(t)&&(e=p[t],e.id="__CR_"+t+"__",e.save="save"in e?e.save.replace("{{id}}",e.id):e.id,e.rRestore=new RegExp(e.id,"g"))}function e(t,e){var n,r=[];for(t.lastIndex=0;n=t.exec(e);)r.push(n[1]);return r}function n(t){return e(l,t)}function r(t){return e(p.OP.rgx,t)}function i(t,e){return t=t||"",t&&(_===d?t=t.replace(f,""):_===v&&(t=t.replace(h,"")),t=o(t,"rgx","save"),t=t.replace(c,"\\$&"),t=o(t,"rRestore","res"),_===d&&(t="\\/?"+t)),_!==g&&(t+="\\/?"),new RegExp("^"+t+"$",e?"i":"")}function o(t,e,n){var r,i;for(i in p)p.hasOwnProperty(i)&&(r=p[i],t=t.replace(r[e],r[n]));return t}function a(t,e,n){var r=e.exec(t);return r&&(r.shift(),n&&(r=u(r))),r}function s(t,e){if("string"!=typeof t)throw new Error("Route pattern should be a string.");var n=function(t,n){var r;if(n="?"===n.substr(0,1)?n.substr(1):n,null!=e[n]){if("object"==typeof e[n]){var i=[];for(var o in e[n])i.push(encodeURI(o+"="+e[n][o]));r="?"+i.join("&")}else r=String(e[n]);if(-1===t.indexOf("*")&&-1!==r.indexOf("/"))throw new Error('Invalid value "'+r+'" for segment "'+t+'".')}else{if(-1!==t.indexOf("{"))throw new Error("The segment "+t+" is required.");r=""}return r};return p.OS.trail||(p.OS.trail=new RegExp("(?:"+p.OS.id+")+$")),t.replace(p.OS.rgx,p.OS.save).replace(l,n).replace(p.OS.trail,"").replace(p.OS.rRestore,"/")}var c=/[\\.+*?\^$\[\](){}\/'#]/g,f=/^\/|\/$/g,h=/\/$/g,l=/(?:\{|:)([^}:]+)(?:\}|:)/g,p={OS:{rgx:/([:}]|\w(?=\/))\/?(:|(?:\{\?))/g,save:"$1{{id}}$2",res:"\\/?"},RS:{rgx:/([:}])\/?(\{)/g,save:"$1{{id}}$2",res:"\\/"},RQ:{rgx:/\{\?([^}]+)\}/g,res:"\\?([^#]+)"},OQ:{rgx:/:\?([^:]+):/g,res:"(?:\\?([^#]*))?"},OR:{rgx:/:([^:]+)\*:/g,res:"(.*)?"},RR:{rgx:/\{([^}]+)\*\}/g,res:"(.+)"},RP:{rgx:/\{([^}]+)\}/g,res:"([^\\/?]+)"},OP:{rgx:/:([^:]+):/g,res:"([^\\/?]+)?/?"}},d=1,g=2,v=3,_=d;return t(),{strict:function(){_=g},loose:function(){_=d},legacy:function(){_=v},getParamIds:n,getOptionalParamsIds:r,getParamValues:a,compilePattern:i,interpolate:s}}(),l};"function"==typeof define&&define.amd?define(["signals"],t):"undefined"!=typeof module&&module.exports?module.exports=t(require("signals")):window.crossroads=t(window.signals)}();/** @license MIT License (c) copyright 2011-2013 original author or authors */
var when=function(t){function e(t,e,n,i){return r(t).then(e,n,i)}function n(t,e){this.then=t,this.inspect=e}function r(t){return a(function(e){e(t)})}function i(t){return e(t,c)}function o(){function t(t,o,a){e.resolve=e.resolver.resolve=function(e){return i?r(e):(i=!0,t(e),n)},e.reject=e.resolver.reject=function(t){return i?r(c(t)):(i=!0,o(t),n)},e.notify=e.resolver.notify=function(t){return a(t),t}}var e,n,i;return e={promise:z,resolve:z,reject:z,notify:z,resolver:{resolve:z,reject:z,notify:z}},e.promise=n=a(t),e}function a(t){function e(t,e,n){return a(function(r,i,o){p?p.push(function(a){a.then(t,e,n).then(r,i,o)}):O(function(){l.then(t,e,n).then(r,i,o)})})}function r(){return l?l.inspect():b()}function i(t){p&&(l=s(t),h(p,l),p=z)}function o(t){i(c(t))}function u(t){p&&h(p,f(t))}var l,p=[];try{t(i,o,u)}catch(d){o(d)}return new n(e,r)}function s(t){return t instanceof n?t:t===Object(t)&&"then"in t?a(function(e,n,r){O(function(){try{var i=t.then;"function"==typeof i?A(i,t,e,n,r):e(u(t))}catch(o){n(o)}})}):u(t)}function u(t){var e=new n(function(n){try{return"function"==typeof n?s(n(t)):e}catch(r){return c(r)}},function(){return x(t)});return e}function c(t){var e=new n(function(n,r){try{return"function"==typeof r?s(r(t)):e}catch(i){return c(i)}},function(){return P(t)});return e}function f(t){var e=new n(function(n,r,i){try{return"function"==typeof i?f(i(t)):e}catch(o){return f(o)}});return e}function h(t,e){O(function(){for(var n,r=0;n=t[r++];)n(e)})}function l(t){return t&&"function"==typeof t.then}function p(t,n,r,i,o){return e(t,function(t){function s(r,i,o){function a(t){p(t)}function s(t){l(t)}var u,c,f,h,l,p,d,g;if(d=t.length>>>0,u=Math.max(0,Math.min(n,d)),f=[],c=d-u+1,h=[],u)for(p=function(t){h.push(t),--c||(l=p=R,i(h))},l=function(t){f.push(t),--u||(l=p=R,r(f))},g=0;d>g;++g)g in t&&e(t[g],s,a,o);else r(f)}return a(s).then(r,i,o)})}function d(t,e,n,r){function i(t){return e?e(t[0]):t[0]}return p(t,1,i,n,r)}function g(t,e,n,r){return y(t,R).then(e,n,r)}function v(){return y(arguments,R)}function _(t){return y(t,x,P)}function m(t,e){return y(t,e)}function y(t,n,r){return e(t,function(t){function i(i,o,a){var s,u,c,f,h;if(c=u=t.length>>>0,s=[],!c)return i(s),void 0;for(f=function(t,u){e(t,n,r).then(function(t){s[u]=t,--c||i(s)},o,a)},h=0;u>h;h++)h in t?f(t[h],h):--c}return a(i)})}function w(t,n){var r=A(L,arguments,1);return e(t,function(t){var i;return i=t.length,r[0]=function(t,r,o){return e(t,function(t){return e(r,function(e){return n(t,e,o,i)})})},q.apply(t,r)})}function x(t){return{state:"fulfilled",value:t}}function P(t){return{state:"rejected",reason:t}}function b(){return{state:"pending"}}function O(t){1===I.push(t)&&S()}function S(){j(E)}function E(){for(var t,e=0;t=I[e++];)t();I=[]}function R(t){return t}e.defer=o,e.resolve=r,e.reject=i,e.join=v,e.all=g,e.map=m,e.reduce=w,e.settle=_,e.any=d,e.some=p,e.isPromise=l,e.promise=a,n.prototype={otherwise:function(t){return this.then(z,t)},ensure:function(t){function e(){return r(t())}return this.then(e,e).yield(this)},yield:function(t){return this.then(function(){return t})},spread:function(t){return this.then(function(e){return g(e,function(e){return t.apply(z,e)})})},always:function(t,e){return this.then(t,t,e)}};var q,L,A,j,I,N,T,$,B,z;return I=[],N=t.setTimeout,j="function"==typeof setImmediate?setImmediate.bind(t):"object"==typeof process&&process.nextTick?process.nextTick:"object"==typeof vertx?vertx.runOnLoop:function(t){N(t,0)},T=Function.prototype,$=T.call,A=T.bind?$.bind($):function(t,e){return t.apply(e,L.call(arguments,2))},B=[],L=B.slice,q=B.reduce||function(t){var e,n,r,i,o;if(o=0,e=Object(this),i=e.length>>>0,n=arguments,n.length<=1)for(;;){if(o in e){r=e[o++];break}if(++o>=i)throw new TypeError}else r=n[1];for(;i>o;++o)o in e&&(r=t(r,e[o],o,e));return r},e}(this);!function(t){function e(){}function n(t,e,r){var i=/(?:([\w0-9]+:))?(?:\/\/(?:[^@]*@)?([^\/:\?#]+)(?::([0-9]+))?)?([^\?#]*)(?:(\?[^#]+)|\?)?(?:(#.*))?/;if(t&&!e){var o=n(),a=o._pathname,s=o._protocol;t=/^(?:[\w0-9]+\:)?\/\//.test(t)?0===t.indexOf("/")?s+t:t:s+"//"+o._host+(0===t.indexOf("/")?t:0===t.indexOf("?")?a+t:0===t.indexOf("#")?a+o._search+t:a.replace(/[^\/]+$/g,"")+t)}else t=e?t:P.href,(!R||r)&&(t=t.replace(/^[^#]*/,"")||"#",t=P.protocol+"//"+P.host+k.basepath+t.replace(new RegExp("^#[/]?(?:"+k.type+")?"),""));V.href=t;var u=i.exec(V.href),c=u[2]+(u[3]?":"+u[3]:""),f=u[4]||"/",h=u[5]||"",l="#"===u[6]?"":u[6]||"",p=f+h+l,d=f.replace(new RegExp("^"+k.basepath,"i"),k.type)+h;return{_href:u[1]+"//"+c+p,_protocol:u[1],_host:c,_hostname:u[2],_port:u[3]||"",_pathname:f,_search:h,_hash:l,_relative:p,_nohash:d,_special:d+l}}function r(){var t="";if(y)t+=y.getItem(F);else{var e=_.cookie.split(F+"=");e.length>1&&(t+=e.pop().split(";").shift()||"null")}try{U=x.parse(t)||{}}catch(n){U={}}$(j+"unload",function(){if(y)y.setItem(F,x.stringify(U));else{var t={};(t[P.href]=O.state)&&(_.cookie=F+"="+x.stringify(t))}},!1)}function i(n,r,i,o){i=i||{set:e};var a=!i.set,s=!i.get,u={configurable:!0,set:function(){a=1},get:function(){s=1}};try{L(n,r,u),n[r]=n[r],L(n,r,i)}catch(c){}if(!a||!s)if(n.__defineGetter__&&(n.__defineGetter__(r,u.get),n.__defineSetter__(r,u.set),n[r]=n[r],i.get&&n.__defineGetter__(r,i.get),i.set&&n.__defineSetter__(r,i.set)),a&&s||n!==t){if(!a||!s)try{try{var f=w.create(n);L(w.getPrototypeOf(f)===n?f:n,r,i);for(var h in n)"function"==typeof n[h]&&(f[h]=n[h].bind(n));try{o.call(f,f,n)}catch(c){}n=f}catch(c){L(n.constructor.prototype,r,i)}}catch(c){return!1}}else{try{var l=n[r];n[r]=null}catch(c){}if("execScript"in t)t.execScript("Public "+r,"VBScript");else try{L(n,r,{value:e})}catch(c){}n[r]=l}return n}function o(t,e,n){return n=n||{},t=t===Y?P:t,n.set=n.set||function(n){t[e]=n},n.get=n.get||function(){return t[e]},n}function a(t,e,n){t in Q?Q[t].push(e):arguments.length>3?$(t,e,n,arguments[3]):$(t,e,n)}function s(t,e,n){var r=Q[t];if(r){for(var i=r.length;--i;)if(r[i]===e){r.splice(i,1);break}}else B(t,e,n)}function u(n,r){var o=(""+("string"==typeof n?n:n.type)).replace(/^on/,""),a=Q[o];if(a){if(r="string"==typeof n?r:n,null==r.target)for(var s=["target","currentTarget","srcElement","type"];n=s.pop();)r=i(r,n,{get:"type"===n?function(){return o}:function(){return t}});(("popstate"===o?t.onpopstate:t.onhashchange)||e).call(t,r);for(var u=0,c=a.length;c>u;u++)a[u].call(t,r);return!0}return z(n,r)}function c(){var t=_.createEvent?_.createEvent("Event"):_.createEventObject();t.initEvent?t.initEvent("popstate",!1,!1):t.type="popstate",t.state=O.state,u(t)}function f(){M&&(M=!1,c())}function h(t,e,r,i){if(!R){var o=n(e);o._relative!==n()._relative&&(C=i,r?P.replace("#"+o._special):P.hash=o._special)}!q&&t&&(U[P.href]=t),M=!1}function l(e){if(C){D!==P.href&&c(),e=e||t.event;var r=n(C,!0),i=n();e.oldURL||(e.oldURL=r._href,e.newURL=i._href),r._hash!==i._hash&&u(e)}C=P.href}function p(t){setTimeout(function(){$("popstate",function(t){D=P.href,q||(t=i(t,"state",{get:function(){return O.state}})),u(t)},!1)},0),!R&&t!==!0&&O.location&&(g(O.location.hash),f())}function d(e){var r=e||t.event,i=r.target||r.srcElement,o="defaultPrevented"in r?r.defaultPrevented:r.returnValue===!1;if(i&&"A"===i.nodeName&&!o){var a=n(),s=n(i.getAttribute("href",2)),u=a._href.split("#").shift()===s._href.split("#").shift();u&&s._hash&&(a._hash!==s._hash&&(O.location.hash=s._hash),g(s._hash),r.preventDefault?r.preventDefault():r.returnValue=!1)}}function g(e){var n=_.getElementById(e=(e||"").replace(/^#/,""));if(n&&n.id===e&&"A"===n.nodeName){var r=n.getBoundingClientRect();t.scrollTo(m.scrollLeft||0,r.top+(m.scrollTop||0)-(m.clientTop||0))}}function v(){var e=_.getElementsByTagName("script"),a=(e[e.length-1]||{}).src||"",s=-1!==a.indexOf("?")?a.split("?").pop():"";s.replace(/(\w+)(?:=([^&]*))?/g,function(t,e,n){k[e]=(n||("basepath"===e?"/":"")).replace(/^(0|false)$/,"")});try{y=t.sessionStorage}catch(u){}$(j+"hashchange",l,!1);var c=[Y,A,G,t,K,O];q&&delete K.state;for(var f=0;f<c.length;f+=2)for(var h in c[f])if(c[f].hasOwnProperty(h))if("function"==typeof c[f][h])c[f+1][h]=c[f][h];else{var g=o(c[f],h,c[f][h]);if(!i(c[f+1],h,g,function(e,n){n===O&&(t.history=O=c[f+1]=e)}))return B(j+"hashchange",l,!1),!1;c[f+1]===t&&(Q[h]=Q[h.substr(2)]=[])}return k.redirect&&O.redirect(),!q&&x&&r(),R||_[I](j+"click",d,!1),"complete"===_.readyState?p(!0):(R||n()._relative===k.basepath||(M=!0),$(j+"load",p,!1)),!0}if(t.history){var _=t.document,m=_.documentElement,y=null,w=t.Object,x=t.JSON,P=t.location,b=t.history,O=b,S=b.pushState,E=b.replaceState,R=!!S,q="state"in b,L=w.defineProperty,A=i({},"t")?{}:_.createElement("a"),j="",I=t.addEventListener?"addEventListener":(j="on")&&"attachEvent",N=t.removeEventListener?"removeEventListener":"detachEvent",T=t.dispatchEvent?"dispatchEvent":"fireEvent",$=t[I],B=t[N],z=t[T],k={basepath:"/",redirect:0,type:"/"},F="__historyAPI__",V=_.createElement("a"),C=P.href,D="",M=!1,U={},Q={},G={onhashchange:null,onpopstate:null},J=function(e,n){var r=t.history!==b;r&&(t.history=b),e.apply(b,n),r&&(t.history=O)},K={redirect:function(e,r){if(k.basepath=r=null==r?k.basepath:r,k.type=e=null==e?k.type:e,t.top==t.self){var i=n(null,!1,!0)._relative,o=P.pathname+P.search;R?(o=o.replace(/([^\/])$/,"$1/"),i!=r&&new RegExp("^"+r+"$","i").test(o)&&P.replace(i)):o!=r&&(o=o.replace(/([^\/])\?/,"$1/?"),new RegExp("^"+r,"i").test(o)&&P.replace(r+"#"+o.replace(new RegExp("^"+r,"i"),e)+P.hash))}},pushState:function(t,e,n){S&&J(S,arguments),h(t,n)},replaceState:function(t,e,n){delete U[P.href],E&&J(E,arguments),h(t,n,!0)},location:{set:function(e){t.location=e},get:function(){return R?P:A}},state:{get:function(){return U[P.href]||null}}},Y={assign:function(t){0===(""+t).indexOf("#")?h(null,t):P.assign(t)},reload:function(){P.reload()},replace:function(t){0===(""+t).indexOf("#")?h(null,t,!0):P.replace(t)},toString:function(){return this.href},href:{get:function(){return n()._href}},protocol:null,host:null,hostname:null,port:null,pathname:{get:function(){return n()._pathname}},search:{get:function(){return n()._search}},hash:{set:function(t){h(null,(""+t).replace(/^(#|)/,"#"),!1,C)},get:function(){return n()._hash}}};v()&&(O.emulate=!R,t[I]=a,t[N]=s,t[T]=u)}}(window),/*! @license
 * abyssa <https://github.com/AlexGalays/abyssa-js/>
 * Author: Alexandre Galays | MIT License
 * v1.2.10 (2013-11-15T07:06:30.011Z)
 */
function(){var t=function(){function t(t){return"[object String]"===Object.prototype.toString.call(t)}function e(){}function n(t){return t.reduce(function(t,e){return t[e]=1,t},{})}function r(t){var e=[];for(var n in t)e.push(t[n]);return e}function i(t){var e={};for(var n in t)e[n]=t[n];return e}function o(t,e){for(var n in e)t[n]=e[n]}function a(t){var e=0;for(var n in t)e++;return e}function s(t,e){var n,r={};t=t||{};for(n in t)t[n]!==e[n]&&(r[n]=1);for(n in e)t[n]!==e[n]&&(r[n]=1);return r}function u(){var t=window&&window.location;if(!t)throw new Error("Browser location object cannot be obtained.");return t}function c(t,e){return(e?"":"/")+t.replace(/^\/+/,"").replace(/^([^?]*?)\/+$/,"$1").replace(/\/+\?/,"?")}function f(t){t=t||u();var e=t.href.indexOf("#/");return c(e>-1?t.href.slice(e+2):t.pathname+t.search)}function h(t){var e;try{e=when(t())}catch(n){e=when.defer().reject(n)}return e}function l(t,e,n,r){function i(t,e){return f.then(function(){u||t()},function(t){u||e(t)})}function o(){u=!0}var a,u,c,f,h=[],l=s(n,r),v=t===e;return t&&(a=g(t,e,v,l),h=_(t,a,v)),c=_(e,a,v).reverse(),f=p(c,h,r).then(function(){u||d(c,h,r)}),P.newTransitionStarted(),{from:t,fromParams:n,to:e,toParams:r,then:i,cancel:o}}function p(t,e,n){return e.forEach(function(t){if(t.exitPrereqs)var e=t._exitPrereqs=h(function(){return t.exitPrereqs()}).then(function(n){t._exitPrereqs===e&&(t._exitPrereqs.value=n)},function(e){var n=new Error('Failed to resolve EXIT prereqs of state "'+t.fullName+'"');throw n.inner=e,n})}),t.forEach(function(t){if(t.enterPrereqs)var e=t._enterPrereqs=h(function(){return t.enterPrereqs(n)}).then(function(n){t._enterPrereqs===e&&(t._enterPrereqs.value=n)},function(e){var n=new Error('Failed to resolve ENTER prereqs of state "'+t.fullName+'"');throw n.inner=e,n})}),when.all(t.concat(e).map(function(t){return t._enterPrereqs||t._exitPrereqs}))}function d(t,e,n){e.forEach(function(t){t.exit(t._exitPrereqs&&t._exitPrereqs.value)}),P.allowed=!0,t.forEach(function(t){t.enter(n,t._enterPrereqs&&t._enterPrereqs.value)}),P.allowed=!1}function g(t,e,n,r){var i,o;if(n)t.parents.slice().reverse().forEach(function(t){for(var e in r)if(t.params[e]||t.queryParams[e]){i=t;break}});else for(var a=0;a<t.parents.length;a++)if(o=t.parents[a],e.parents.indexOf(o)>-1){i=o;break}return i}function v(t,e,n){var r=t.parents,i=Math.min(r.length,r.indexOf(e)+(n?1:0));return[t].concat(r.slice(0,i))}function _(t,e,n){var r=!e||n;return v(t,e||t.root,r)}function m(){function t(t,e){d.name=t,d.parent=e,d.parents=r(),d.children=i(),d.fullName=a(),d.root=d.parents[d.parents.length-1],d.async=x.Async,f(function(t,e){e.init(t,d)}),p=!0}function n(){for(var t=d.path,e=d.parent;e;)e.path&&(t=e.path+"/"+t),e=e.parent;return c(t)}function r(){for(var t=[],e=d.parent;e;)t.push(e),e=e.parent;return t}function i(){var t=[];for(var e in _)t.push(_[e]);return t}function o(t){var e={};for(var n in t)t[n]._isState&&(e[n]=t[n]);return e}function a(){return d.parents.reduceRight(function(t,e){return t+e.name+"."},"")+d.name}function s(t){var e={enter:1,exit:1,enterPrereqs:1,exitPrereqs:1},n={};for(var r in t)e[r]||t[r]._isState||(n[r]=t[r]);return n}function u(t,e){if(void 0!==e){if(void 0!==d.ownData[t])throw new Error("State "+d.fullName+" already has data with the key "+t);return d.ownData[t]=e,void 0}for(var n=d;void 0===n.ownData[t]&&n.parent;)n=n.parent;return n.ownData[t]}function f(t){for(var e in _)t(e,_[e])}function h(t,e){if(p)throw new Error("States can only be added before the Router is initialized");if(_[t])throw new Error("The state {0} already has a child state named {1}".replace("{0}",e.name).replace("{1}",t));_[t]=e}function l(){return d.fullName}var p,d={_isState:!0},g=y(arguments),v=g.options,_=o(g.options);return d.path=g.path,d.params=g.params,d.queryParams=g.queryParams,d.states=_,d.enter=v.enter||e,d.exit=v.exit||e,d.enterPrereqs=v.enterPrereqs,d.exitPrereqs=v.exitPrereqs,d.ownData=s(v),d.init=t,d.getFullPath=n,d.data=u,d.addState=h,d.toString=l,d}function y(e){var r,i={path:"",options:{},params:{},queryParams:{}},o=e[0],a=e[1];return 1===e.length?t(o)?i.path=o:i.options=o:2===e.length&&(i.path=o,i.options="object"==typeof a?a:{enter:a}),i.path=c(i.path,!0),r=i.path.indexOf("?"),-1!==r&&(i.queryParams=i.path.slice(r+1),i.path=i.path.slice(0,r),i.queryParams=n(i.queryParams.split("&"))),i.path=i.path.replace(/[\:\{][^\/]+/g,function(t){var e,n=t.charAt(t.length-1);return"}"===n||":"===n?(e=t.substring(1,t.length-1),i.params[e]=1,t):(e=t.substring(1),i.params[e]=1,"{"+e+"}")}),i}function w(t){function n(t,n){u(t,n)||(I&&(b("Cancelling existing transition from {0} to {1}",I.from,I.to),I.cancel(),B.transition.cancelled.dispatch(I.from,I.to,I.fromParams,I.toParams)),b!==e&&b("Starting transition from {0}:{1} to {2}:{3}",A,JSON.stringify(j),t,JSON.stringify(n)),B.transition.started.dispatch(A,t,j,n),I=l(A,t,j,n),I.then(function(){var e,r=A,i=j;A=t,j=n,I=null,T||F||(e=L,b("Pushing state: {0}",e),history.pushState(e,window.document&&window.document.title||"",e)),b("Transition from {0} to {1} completed",r,t),B.transition.completed.dispatch(r,A,i,j),F=!1},function(e){I=null,O("Transition from {0} to {1} failed: {2}",A,t,e),B.transition.failed.dispatch(A,t,j,n,e)}))}function u(t,e){var n,r,i;return I?(n=I.to,r=I.toParams):(n=A,r=j),i=s(r,e),t===n&&0===a(i)}function h(t){return!t||t.indexOf("/")>-1||t.indexOf("?")>-1}function p(t,e){if(b("State not found: {0}",t),!z.notFound)throw new Error('State "'+t+'" could not be found');n(z.notFound,h(t)?{pathQuery:t}:{name:t,params:e||{}})}function d(t,e){return b("Router init"),g(),t=!w.ignoreInitialURL&&f()||t||"",b("Initializing to state {0}",t),m(t,e),window.onpopstate=function(t){var e=t.state||f();b("Popped state: {0}",e),T=!0,y(e)},$=!0,S(B),B}function g(){v(function(t,e){e.init(t)}),_(function(t){V[t.fullName]=t,t.route=k.addRoute(t.getFullPath()+":?query:"),t.route.matched.add(function(){N=!0,n(t,E(t,arguments))})})}function v(t){for(var e in z)t(e,z[e])}function _(t){function e(n){n.forEach(function(n){n.children.length?e(n.children):t(n)})}e(r(z))}function m(t,e){var n=h(t);b("Changing state to {0} {1}",t,n?"(path)":"(name)"),T=!1,n?y(t):x(t,e||{})}function y(t){L=c(t),N=!1,k.parse(L),N||p(L)}function x(t,e){var n=V[t];if(!n)return p(t,e);var r=n.route.interpolate(e);y(r)}function P(t,e){if($)throw new Error("States can only be added before the Router is initialized");if(z[t])throw new Error("A state already exist in the router with the name "+t);b("Adding state {0}",t),z[t]=e}function E(t,e){var n,r=Array.prototype.slice.apply(e),i=r.pop(),a={};return t.getFullPath().replace(/(?:\{\w+?\})|(?:\:[^\:\/]+\:)/g,function(t){return n=t.slice(1,-1),a[n]=r.shift(),""}),i&&o(a,i),a}function R(t,e){var n={},r={},i=!1,a=V[t];if(!a)throw new Error("Cannot find state "+t);[a].concat(a.parents).forEach(function(t){o(r,t.queryParams)});for(var s in e)r[s]&&(n[s]=e[s],delete e[s],i=!0);return i&&(e.query=n),c(a.route.interpolate(e))}function q(){B.transition.ended.dispatch.apply(B.transition.ended,arguments)}var L,A,j,I,N,T,$,B={},z=i(t),k=crossroads.create(),F=!0,V={};return k.shouldTypecast=!0,k.ignoreState=!0,B.init=d,B.state=m,B.addState=P,B.link=R,B.transition={started:new signals.Signal,ended:new signals.Signal,completed:new signals.Signal,failed:new signals.Signal,cancelled:new signals.Signal},B.initialized=new signals.Signal,B.transition.completed.addOnce(function(t,e,n,r){B.initialized.dispatch(e,r)}),B.transition.completed.add(q),B.transition.failed.add(q),B.transition.cancelled.add(q),B}var x={};x.getParamDiff=s,x.getLocationObject=u,x.normalizePathQuery=c,x.getPathQuery=f;var P=function(){function t(t){if(!n.allowed)throw new Error("Async can only be called from within state.enter()");var e=when.defer();return r.push(e),when(t).then(function(t){r.indexOf(e)>-1&&e.resolve(t)},function(t){r.indexOf(e)>-1&&e.reject(t)}),e.promise}function e(){r.length=0}var n,r=[];return n={register:t,newTransitionStarted:e,allowed:!1}}();x.Async=P.register,x.State=m;var b=e,O=e;w.enableLogs=function(){function t(t){for(var e=t[0],n=Array.prototype.slice.call(t,1),r=0,i=n.length;i>r;r++)e=e.replace("{"+r+"}",n[r]);return e}b=function(){"undefined"!=typeof console&&console.log(t(arguments))},O=function(){"undefined"!=typeof console&&console.error(t(arguments))}},x.Router=w;var S=function(t){function e(t){var e=t.which,n=t.button;return e||"undefined"==typeof n||(e=1&n?1:2&n?3:4&n?2:1),1===e}function n(t){for(;t;){if("A"===t.nodeName)return t;t=t.parentNode}}function r(e){var n=t.document.createElement("A");return n.href=e.href,n.protocol===i.protocol&&n.hostname===i.hostname&&(n.port||"80")===(i.port||"80")}if(t&&t.document){var i=u();return function(i){function o(o){var a=o||t.event,s=a.target||a.srcElement,u="defaultPrevented"in a?a.defaultPrevented:a.returnValue===!1;if(!(u||a.metaKey||a.ctrlKey||a.shiftKey||a.altKey)&&e(a)){var c=n(s);c&&c.getAttribute("href",2)&&!c.getAttribute("target")&&r(c)&&!/([a-z0-9_\-]+\:)?\/\/[^@]+@/.test(c.href)&&(a.preventDefault?a.preventDefault():a.returnValue=!1,i.state(f(c)))}}t.document.addEventListener?t.document.addEventListener("click",o):t.document.attachEvent&&t.document.attachEvent("onclick",o)}}}(this);return x};"function"==typeof define&&define.amd?define(["abyssa"],t):"undefined"!=typeof module&&module.exports?module.exports=t():window.Abyssa=t()}();