;/** @license
 * JS Signals <http://millermedeiros.github.com/js-signals/>
 * Released under the MIT license
 * Author: Miller Medeiros
 * Version: 0.8.1 - Build: 266 (2012/07/31 03:33 PM)
 */
var Signal=function(t){function e(t,e,n,r,i){this._listener=e,this._isOnce=n,this.context=r,this._signal=t,this._priority=i||0}function n(t,e){if("function"!=typeof t)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",e))}function r(){this._bindings=[],this._prevParams=null}e.prototype={active:!0,params:null,execute:function(t){var e,n;return this.active&&this._listener&&(n=this.params?this.params.concat(t):t,e=this._listener.apply(this.context,n),this._isOnce&&this.detach()),e},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},getListener:function(){return this._listener},_destroy:function(){delete this._signal,delete this._listener,delete this.context},isOnce:function(){return this._isOnce},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},r.prototype={VERSION:"0.8.1",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(t,n,r,i){var o,a=this._indexOfListener(t,r);if(-1!==a){if(o=this._bindings[a],o.isOnce()!==n)throw new Error("You cannot add"+(n?"":"Once")+"() then add"+(n?"Once":"")+"() the same listener without removing the relationship first.")}else o=new e(this,t,n,r,i),this._addBinding(o);return this.memorize&&this._prevParams&&o.execute(this._prevParams),o},_addBinding:function(t){var e=this._bindings.length;do--e;while(this._bindings[e]&&t._priority<=this._bindings[e]._priority);this._bindings.splice(e+1,0,t)},_indexOfListener:function(t,e){for(var n,r=this._bindings.length;r--;)if(n=this._bindings[r],n._listener===t&&n.context===e)return r;return-1},has:function(t,e){return-1!==this._indexOfListener(t,e)},add:function(t,e,r){return n(t,"add"),this._registerListener(t,!1,e,r)},addOnce:function(t,e,r){return n(t,"addOnce"),this._registerListener(t,!0,e,r)},remove:function(t,e){n(t,"remove");var r=this._indexOfListener(t,e);return-1!==r&&(this._bindings[r]._destroy(),this._bindings.splice(r,1)),t},removeAll:function(){for(var t=this._bindings.length;t--;)this._bindings[t]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active){var t,e=Array.prototype.slice.call(arguments),n=this._bindings.length;if(this.memorize&&(this._prevParams=e),n){t=this._bindings.slice(),this._shouldPropagate=!0;do n--;while(t[n]&&this._shouldPropagate&&t[n].execute(e)!==!1)}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var i=r;return i.Signal=r,t.signals=i,r}(this),crossroads=function(){var t=function(t){function e(t,e){if(t.indexOf)return t.indexOf(e);for(var n=t.length;n--;)if(t[n]===e)return n;return-1}function n(t,n){var r=e(t,n);-1!==r&&t.splice(r,1)}function r(t,e){return"[object "+e+"]"===Object.prototype.toString.call(t)}function i(t){return r(t,"RegExp")}function o(t){return r(t,"Array")}function a(t){return"function"==typeof t}function s(t){var e;return e=null===t||"null"===t?null:"true"===t?!0:"false"===t?!1:t===d||"undefined"===t?d:""===t||isNaN(t)?t:parseFloat(t)}function u(t){for(var e=t.length,n=[];e--;)n[e]=s(t[e]);return n}function c(t,e){for(var n,r,i=(t||"").replace("?","").split("&"),o=i.length,a={};o--;)n=i[o].split("="),r=e?s(n[1]):n[1],a[n[0]]="string"==typeof r?decodeURIComponent(r):r;return a}function f(){this.bypassed=new t.Signal,this.routed=new t.Signal,this._routes=[],this._prevRoutes=[],this._piped=[],this.resetState()}function l(e,n,r,o){var a=i(e),s=o.patternLexer;this._router=o,this._pattern=e,this._paramsIds=a?null:s.getParamIds(e),this._optionalParamsIds=a?null:s.getOptionalParamsIds(e),this._matchRegexp=a?e:s.compilePattern(e,o.ignoreCase),this.matched=new t.Signal,this.switched=new t.Signal,n&&this.matched.add(n),this._priority=r||0}var h,p,d;return p=""===/t(.+)?/.exec("t")[1],f.prototype={greedy:!1,greedyEnabled:!0,ignoreCase:!0,ignoreState:!1,shouldTypecast:!1,normalizeFn:null,resetState:function(){this._prevRoutes.length=0,this._prevMatchedRequest=null,this._prevBypassedRequest=null},create:function(){return new f},addRoute:function(t,e,n){var r=new l(t,e,n,this);return this._sortedInsert(r),r},removeRoute:function(t){n(this._routes,t),t._destroy()},removeAllRoutes:function(){for(var t=this.getNumRoutes();t--;)this._routes[t]._destroy();this._routes.length=0},parse:function(t,e){if(t=t||"",e=e||[],this.ignoreState||t!==this._prevMatchedRequest&&t!==this._prevBypassedRequest){var n,r=this._getMatchedRoutes(t),i=0,o=r.length;if(o)for(this._prevMatchedRequest=t,this._notifyPrevRoutes(r,t),this._prevRoutes=r;o>i;)n=r[i],n.route.matched.dispatch.apply(n.route.matched,e.concat(n.params)),n.isFirst=!i,this.routed.dispatch.apply(this.routed,e.concat([t,n])),i+=1;else this._prevBypassedRequest=t,this.bypassed.dispatch.apply(this.bypassed,e.concat([t]));this._pipeParse(t,e)}},_notifyPrevRoutes:function(t,e){for(var n,r=0;n=this._prevRoutes[r++];)n.route.switched&&this._didSwitch(n.route,t)&&n.route.switched.dispatch(e)},_didSwitch:function(t,e){for(var n,r=0;n=e[r++];)if(n.route===t)return!1;return!0},_pipeParse:function(t,e){for(var n,r=0;n=this._piped[r++];)n.parse(t,e)},getNumRoutes:function(){return this._routes.length},_sortedInsert:function(t){var e=this._routes,n=e.length;do--n;while(e[n]&&t._priority<=e[n]._priority);e.splice(n+1,0,t)},_getMatchedRoutes:function(t){for(var e,n=[],r=this._routes,i=r.length;(e=r[--i])&&((!n.length||this.greedy||e.greedy)&&e.match(t)&&n.push({route:e,params:e._getParamsArray(t)}),this.greedyEnabled||!n.length););return n},pipe:function(t){this._piped.push(t)},unpipe:function(t){n(this._piped,t)},toString:function(){return"[crossroads numRoutes:"+this.getNumRoutes()+"]"}},h=new f,h.VERSION="0.12.0",h.NORM_AS_ARRAY=function(t,e){return[e.vals_]},h.NORM_AS_OBJECT=function(t,e){return[e]},l.prototype={greedy:!1,rules:void 0,match:function(t){return t=t||"",this._matchRegexp.test(t)&&this._validateParams(t)},_validateParams:function(t){var e,n=this.rules,r=this._getParamsObject(t);for(e in n)if("normalize_"!==e&&n.hasOwnProperty(e)&&!this._isValidParam(t,e,r))return!1;return!0},_isValidParam:function(t,n,r){var s=this.rules[n],u=r[n],c=!1,f=0===n.indexOf("?");return null==u&&this._optionalParamsIds&&-1!==e(this._optionalParamsIds,n)?c=!0:i(s)?(f&&(u=r[n+"_"]),c=s.test(u)):o(s)?(f&&(u=r[n+"_"]),c=this._isValidArrayRule(s,u)):a(s)&&(c=s(u,t,r)),c},_isValidArrayRule:function(t,n){if(!this._router.ignoreCase)return-1!==e(t,n);"string"==typeof n&&(n=n.toLowerCase());for(var r,i,o=t.length;o--;)if(r=t[o],i="string"==typeof r?r.toLowerCase():r,i===n)return!0;return!1},_getParamsObject:function(t){for(var n,r,i=this._router.shouldTypecast,o=this._router.patternLexer.getParamValues(t,this._matchRegexp,i),a={},u=o.length;u--;)r=o[u],this._paramsIds&&(n=this._paramsIds[u],0===n.indexOf("?")&&r&&(a[n+"_"]=r,r=c(r,i),o[u]=r),p&&""===r&&-1!==e(this._optionalParamsIds,n)&&(r=void 0,o[u]=r),a[n]=r),a[u]=r;return a.request_=i?s(t):t,a.vals_=o,a},_getParamsArray:function(t){var e,n=this.rules?this.rules.normalize_:null;return n=n||this._router.normalizeFn,e=n&&a(n)?n(t,this._getParamsObject(t)):this._getParamsObject(t).vals_},interpolate:function(t){var e=this._router.patternLexer.interpolate(this._pattern,t);if(!this._validateParams(e))throw new Error("Generated string doesn't validate against `Route.rules`.");return e},dispose:function(){this._router.removeRoute(this)},_destroy:function(){this.matched.dispose(),this.switched.dispose(),this.matched=this.switched=this._pattern=this._matchRegexp=null},toString:function(){return'[Route pattern:"'+this._pattern+'", numListeners:'+this.matched.getNumListeners()+"]"}},f.prototype.patternLexer=function(){function t(){var t,e;for(t in p)p.hasOwnProperty(t)&&(e=p[t],e.id="__CR_"+t+"__",e.save="save"in e?e.save.replace("{{id}}",e.id):e.id,e.rRestore=new RegExp(e.id,"g"))}function e(t,e){var n,r=[];for(t.lastIndex=0;n=t.exec(e);)r.push(n[1]);return r}function n(t){return e(h,t)}function r(t){return e(p.OP.rgx,t)}function i(t,e){return t=t||"",t&&(_===d?t=t.replace(f,""):_===v&&(t=t.replace(l,"")),t=o(t,"rgx","save"),t=t.replace(c,"\\$&"),t=o(t,"rRestore","res"),_===d&&(t="\\/?"+t)),_!==g&&(t+="\\/?"),new RegExp("^"+t+"$",e?"i":"")}function o(t,e,n){var r,i;for(i in p)p.hasOwnProperty(i)&&(r=p[i],t=t.replace(r[e],r[n]));return t}function a(t,e,n){var r=e.exec(t);return r&&(r.shift(),n&&(r=u(r))),r}function s(t,e){if("string"!=typeof t)throw new Error("Route pattern should be a string.");var n=function(t,n){var r;if(n="?"===n.substr(0,1)?n.substr(1):n,null!=e[n]){if("object"==typeof e[n]){var i=[];for(var o in e[n])i.push(encodeURI(o+"="+e[n][o]));r="?"+i.join("&")}else r=String(e[n]);if(-1===t.indexOf("*")&&-1!==r.indexOf("/"))throw new Error('Invalid value "'+r+'" for segment "'+t+'".')}else{if(-1!==t.indexOf("{"))throw new Error("The segment "+t+" is required.");r=""}return r};return p.OS.trail||(p.OS.trail=new RegExp("(?:"+p.OS.id+")+$")),t.replace(p.OS.rgx,p.OS.save).replace(h,n).replace(p.OS.trail,"").replace(p.OS.rRestore,"/")}var c=/[\\.+*?\^$\[\](){}\/'#]/g,f=/^\/|\/$/g,l=/\/$/g,h=/(?:\{|:)([^}:]+)(?:\}|:)/g,p={OS:{rgx:/([:}]|\w(?=\/))\/?(:|(?:\{\?))/g,save:"$1{{id}}$2",res:"\\/?"},RS:{rgx:/([:}])\/?(\{)/g,save:"$1{{id}}$2",res:"\\/"},RQ:{rgx:/\{\?([^}]+)\}/g,res:"\\?([^#]+)"},OQ:{rgx:/:\?([^:]+):/g,res:"(?:\\?([^#]*))?"},OR:{rgx:/:([^:]+)\*:/g,res:"(.*)?"},RR:{rgx:/\{([^}]+)\*\}/g,res:"(.+)"},RP:{rgx:/\{([^}]+)\}/g,res:"([^\\/?]+)"},OP:{rgx:/:([^:]+):/g,res:"([^\\/?]+)?/?"}},d=1,g=2,v=3,_=d;return t(),{strict:function(){_=g},loose:function(){_=d},legacy:function(){_=v},getParamIds:n,getOptionalParamsIds:r,getParamValues:a,compilePattern:i,interpolate:s}}(),h};return t(window.signals)}(),when=function(t){function e(t,e,n,i){return r(t).then(e,n,i)}function n(t,e){this.then=t,this.inspect=e}function r(t){return a(function(e){e(t)})}function i(t){return e(t,c)}function o(){function t(t,o,a){e.resolve=e.resolver.resolve=function(e){return i?r(e):(i=!0,t(e),n)},e.reject=e.resolver.reject=function(t){return i?r(c(t)):(i=!0,o(t),n)},e.notify=e.resolver.notify=function(t){return a(t),t}}var e,n,i;return e={promise:k,resolve:k,reject:k,notify:k,resolver:{resolve:k,reject:k,notify:k}},e.promise=n=a(t),e}function a(t){function e(t,e,n){return a(function(r,i,o){p?p.push(function(a){a.then(t,e,n).then(r,i,o)}):O(function(){h.then(t,e,n).then(r,i,o)})})}function r(){return h?h.inspect():b()}function i(t){p&&(h=s(t),l(p,h),p=k)}function o(t){i(c(t))}function u(t){p&&l(p,f(t))}var h,p=[];try{t(i,o,u)}catch(d){o(d)}return new n(e,r)}function s(t){return t instanceof n?t:t===Object(t)&&"then"in t?a(function(e,n,r){O(function(){try{var i=t.then;"function"==typeof i?A(i,t,e,n,r):e(u(t))}catch(o){n(o)}})}):u(t)}function u(t){var e=new n(function(n){try{return"function"==typeof n?s(n(t)):e}catch(r){return c(r)}},function(){return x(t)});return e}function c(t){var e=new n(function(n,r){try{return"function"==typeof r?s(r(t)):e}catch(i){return c(i)}},function(){return P(t)});return e}function f(t){var e=new n(function(n,r,i){try{return"function"==typeof i?f(i(t)):e}catch(o){return f(o)}});return e}function l(t,e){O(function(){for(var n,r=0;n=t[r++];)n(e)})}function h(t){return t&&"function"==typeof t.then}function p(t,n,r,i,o){return e(t,function(t){function s(r,i,o){function a(t){p(t)}function s(t){h(t)}var u,c,f,l,h,p,d,g;if(d=t.length>>>0,u=Math.max(0,Math.min(n,d)),f=[],c=d-u+1,l=[],u)for(p=function(t){l.push(t),--c||(h=p=E,i(l))},h=function(t){f.push(t),--u||(h=p=E,r(f))},g=0;d>g;++g)g in t&&e(t[g],s,a,o);else r(f)}return a(s).then(r,i,o)})}function d(t,e,n,r){function i(t){return e?e(t[0]):t[0]}return p(t,1,i,n,r)}function g(t,e,n,r){return y(t,E).then(e,n,r)}function v(){return y(arguments,E)}function _(t){return y(t,x,P)}function m(t,e){return y(t,e)}function y(t,n,r){return e(t,function(t){function i(i,o,a){var s,u,c,f,l;if(c=u=t.length>>>0,s=[],!c)return i(s),void 0;for(f=function(t,u){e(t,n,r).then(function(t){s[u]=t,--c||i(s)},o,a)},l=0;u>l;l++)l in t?f(t[l],l):--c}return a(i)})}function w(t,n){var r=A(L,arguments,1);return e(t,function(t){var i;return i=t.length,r[0]=function(t,r,o){return e(t,function(t){return e(r,function(e){return n(t,e,o,i)})})},q.apply(t,r)})}function x(t){return{state:"fulfilled",value:t}}function P(t){return{state:"rejected",reason:t}}function b(){return{state:"pending"}}function O(t){1===N.push(t)&&S()}function S(){I(R)}function R(){for(var t,e=0;t=N[e++];)t();N=[]}function E(t){return t}e.defer=o,e.resolve=r,e.reject=i,e.join=v,e.all=g,e.map=m,e.reduce=w,e.settle=_,e.any=d,e.some=p,e.isPromise=h,e.promise=a,n.prototype={otherwise:function(t){return this.then(k,t)},ensure:function(t){function e(){return r(t())}return this.then(e,e).yield(this)},yield:function(t){return this.then(function(){return t})},spread:function(t){return this.then(function(e){return g(e,function(e){return t.apply(k,e)})})},always:function(t,e){return this.then(t,t,e)}};var q,L,A,I,N,j,T,B,$,k;return N=[],j=t.setTimeout,I="function"==typeof setImmediate?setImmediate.bind(t):"object"==typeof process&&process.nextTick?process.nextTick:"object"==typeof vertx?vertx.runOnLoop:function(t){j(t,0)},T=Function.prototype,B=T.call,A=T.bind?B.bind(B):function(t,e){return t.apply(e,L.call(arguments,2))},$=[],L=$.slice,q=$.reduce||function(t){var e,n,r,i,o;if(o=0,e=Object(this),i=e.length>>>0,n=arguments,n.length<=1)for(;;){if(o in e){r=e[o++];break}if(++o>=i)throw new TypeError}else r=n[1];for(;i>o;++o)o in e&&(r=t(r,e[o],o,e));return r},e}(this);/*! @license
 * History API JavaScript Library v4.0.0
 *
 * Support: IE8+, FF3+, Opera 9+, Safari, Chrome and other
 *
 * Copyright 2011-2013, Dmitrii Pakhtinov ( spb.piksel@gmail.com )
 *
 * http://spb-piksel.ru/
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 * Update: 19.05.13 22:46
 */
!function(t){function e(){}function n(t,e,r){var i=/(?:([\w0-9]+:))?(?:\/\/(?:[^@]*@)?([^\/:\?#]+)(?::([0-9]+))?)?([^\?#]*)(?:(\?[^#]+)|\?)?(?:(#.*))?/;if(t&&!e){var o=n(),a=o._pathname,s=o._protocol;t=/^(?:[\w0-9]+\:)?\/\//.test(t)?0===t.indexOf("/")?s+t:t:s+"//"+o._host+(0===t.indexOf("/")?t:0===t.indexOf("?")?a+t:0===t.indexOf("#")?a+o._search+t:a.replace(/[^\/]+$/g,"")+t)}else t=e?t:P.href,(!E||r)&&(t=t.replace(/^[^#]*/,"")||"#",t=P.protocol+"//"+P.host+z.basepath+t.replace(new RegExp("^#[/]?(?:"+z.type+")?"),""));V.href=t;var u=i.exec(V.href),c=u[2]+(u[3]?":"+u[3]:""),f=u[4]||"/",l=u[5]||"",h="#"===u[6]?"":u[6]||"",p=f+l+h,d=f.replace(new RegExp("^"+z.basepath,"i"),z.type)+l;return{_href:u[1]+"//"+c+p,_protocol:u[1],_host:c,_hostname:u[2],_port:u[3]||"",_pathname:f,_search:l,_hash:h,_relative:p,_nohash:d,_special:d+h}}function r(t){var e="";if(y)e+=y.getItem(C);else{var n=_.cookie.split(C+"=");n.length>1&&(e+=n.pop().split(";").shift()||"null")}try{U=t.parse(e)||{}}catch(r){U={}}B(I+"unload",function(){if(y)y.setItem(C,t.stringify(U));else{var e={};(e[P.href]=O.state)&&(_.cookie=C+"="+t.stringify(e))}},!1)}function i(n,r,i,o){i=i||{set:e};var a=!i.set,s=!i.get,u={configurable:!0,set:function(){a=1},get:function(){s=1}};try{L(n,r,u),n[r]=n[r],L(n,r,i)}catch(c){}if(!a||!s)if(n.__defineGetter__&&(n.__defineGetter__(r,u.get),n.__defineSetter__(r,u.set),n[r]=n[r],i.get&&n.__defineGetter__(r,i.get),i.set&&n.__defineSetter__(r,i.set)),a&&s||n!==t){if(!a||!s)try{try{var f=w.create(n);L(w.getPrototypeOf(f)===n?f:n,r,i);for(var l in n)"function"==typeof n[l]&&(f[l]=n[l].bind(n));try{o.call(f,f,n)}catch(c){}n=f}catch(c){L(n.constructor.prototype,r,i)}}catch(c){return!1}}else{try{var h=n[r];n[r]=null}catch(c){}if("execScript"in t)t.execScript("Public "+r,"VBScript");else try{L(n,r,{value:e})}catch(c){}n[r]=h}return n}function o(t,e,n){return n=n||{},t=t===Q?P:t,n.set=n.set||function(n){t[e]=n},n.get=n.get||function(){return t[e]},n}function a(t,e,n){t in G?G[t].push(e):arguments.length>3?B(t,e,n,arguments[3]):B(t,e,n)}function s(t,e,n){var r=G[t];if(r){for(var i=r.length;--i;)if(r[i]===e){r.splice(i,1);break}}else $(t,e,n)}function u(n,r){var o=(""+("string"==typeof n?n:n.type)).replace(/^on/,""),a=G[o];if(a){if(r="string"==typeof n?r:n,null==r.target)for(var s=["target","currentTarget","srcElement","type"];n=s.pop();)r=i(r,n,{get:"type"===n?function(){return o}:function(){return t}});(("popstate"===o?t.onpopstate:t.onhashchange)||e).call(t,r);for(var u=0,c=a.length;c>u;u++)a[u].call(t,r);return!0}return k(n,r)}function c(){var t=_.createEvent?_.createEvent("Event"):_.createEventObject();t.initEvent?t.initEvent("popstate",!1,!1):t.type="popstate",t.state=O.state,u(t)}function f(){D&&(D=!1,c())}function l(t,e,r,i){if(!E){var o=n(e);o._relative!==n()._relative&&(F=i,r?P.replace("#"+o._special):P.hash=o._special)}!q&&t&&(U[P.href]=t),D=!1}function h(e){if(F){M!==P.href&&c(),e=e||t.event;var r=n(F,!0),i=n();e.oldURL||(e.oldURL=r._href,e.newURL=i._href),r._hash!==i._hash&&u(e)}F=P.href}function p(t){setTimeout(function(){B("popstate",function(t){M=P.href,q||(t=i(t,"state",{get:function(){return O.state}})),u(t)},!1)},0),!E&&t!==!0&&O.location&&(g(O.location.hash),f())}function d(e){var r=e||t.event,i=r.target||r.srcElement,o="defaultPrevented"in r?r.defaultPrevented:r.returnValue===!1;if(i&&"A"===i.nodeName&&!o){var a=n(),s=n(i.getAttribute("href",2)),u=a._href.split("#").shift()===s._href.split("#").shift();u&&(a._hash!==s._hash&&(O.location.hash=s._hash),g(s._hash),r.preventDefault?r.preventDefault():r.returnValue=!1)}}function g(e){var n=_.getElementById(e=(e||"").replace(/^#/,""));if(n&&n.id===e&&"A"===n.nodeName){var r=n.getBoundingClientRect();t.scrollTo(m.scrollLeft||0,r.top+(m.scrollTop||0)-(m.clientTop||0))}}function v(){var e=_.getElementsByTagName("script"),a=(e[e.length-1]||{}).src||"",s=-1!==a.indexOf("?")?a.split("?").pop():"";s.replace(/(\w+)(?:=([^&]*))?/g,function(t,e,n){z[e]=(n||("basepath"===e?"/":"")).replace(/^(0|false)$/,"")}),B(I+"hashchange",h,!1);var u=[Q,A,J,t,K,O];q&&delete K.state;for(var c=0;c<u.length;c+=2)for(var f in u[c])if(u[c].hasOwnProperty(f))if("function"==typeof u[c][f])u[c+1][f]=u[c][f];else{var l=o(u[c],f,u[c][f]);if(!i(u[c+1],f,l,function(e,n){n===O&&(t.history=O=u[c+1]=e)}))return $(I+"hashchange",h,!1),!1;u[c+1]===t&&(G[f]=G[f.substr(2)]=[])}return z.redirect&&O.redirect(),!q&&x&&r(x),E||_[N](I+"click",d,!1),"complete"===_.readyState?p(!0):(E||n()._relative===z.basepath||(D=!0),B(I+"load",p,!1)),!0}var _=t.document,m=_.documentElement,y=t.sessionStorage,w=t.Object,x=t.JSON,P=t.location,b=t.history,O=b,S=b.pushState,R=b.replaceState,E=!!S,q="state"in b,L=w.defineProperty,A=i({},"t")?{}:_.createElement("a"),I="",N=t.addEventListener?"addEventListener":(I="on")&&"attachEvent",j=t.removeEventListener?"removeEventListener":"detachEvent",T=t.dispatchEvent?"dispatchEvent":"fireEvent",B=t[N],$=t[j],k=t[T],z={basepath:"/",redirect:0,type:"/"},C="__historyAPI__",V=_.createElement("a"),F=P.href,M="",D=!1,U={},G={},J={onhashchange:null,onpopstate:null},K={redirect:function(e,r){if(z.basepath=r=null==r?z.basepath:r,z.type=e=null==e?z.type:e,t.top==t.self){var i=n(null,!1,!0)._relative,o=P.search,a=P.pathname;E?(i!=r&&new RegExp("^"+r+"$","i").test(a)&&P.replace(i),new RegExp("^"+r+"$","i").test(a+"/")?P.replace(r):new RegExp("^"+r,"i").test(a)||P.replace(a.replace(/^\//,r)+o)):a!=r&&P.replace(r+"#"+a.replace(new RegExp("^"+r,"i"),e)+o+P.hash)}},pushState:function(t,e,n){S&&S.apply(b,arguments),l(t,n)},replaceState:function(t,e,n){delete U[P.href],R&&R.apply(b,arguments),l(t,n,!0)},location:{set:function(e){t.location=e},get:function(){return E?P:A}},state:{get:function(){return U[P.href]||null}}},Q={assign:function(t){0===(""+t).indexOf("#")?l(null,t):P.assign(t)},reload:function(){P.reload()},replace:function(t){0===(""+t).indexOf("#")?l(null,t,!0):P.replace(t)},toString:function(){return this.href},href:{get:function(){return n()._href}},protocol:null,host:null,hostname:null,port:null,pathname:{get:function(){return n()._pathname}},search:{get:function(){return n()._search}},hash:{set:function(t){l(null,(""+t).replace(/^(#|)/,"#"),!1,F)},get:function(){return n()._hash}}};v()&&(O.emulate=!E,t[N]=a,t[j]=s,t[T]=u)}(window),/** @license
 * abyssa <https://github.com/AlexGalays/abyssa-js/>
 * Author: Alexandre Galays | MIT License
 * v1.1.2 (2013-09-10T15:42:58.015Z)
 */
function(){var t=function(){function t(t){return"[object String]"==Object.prototype.toString.call(t)}function e(){}function n(t){return t.reduce(function(t,e){return t[e]=1,t},{})}function r(t){var e=[];for(var n in t)e.push(t[n]);return e}function i(t){var e={};for(var n in t)e[n]=t[n];return e}function o(t,e){for(var n in e)t[n]=e[n]}function a(t){var e=0;for(var n in t)e++;return e}function s(t,e,n,r){function i(t,e){return p.then(function(){s||t()},function(t){s||e(t)})}function o(){s=!0}var a,s,l,p,d=[],g=t==e;return t&&(a=f(t,e,g,r),d=h(t,a,g)),l=h(e,a,g).reverse(),p=u(l,d,n).then(function(){s||c(l,d,n)}),y.newTransitionStarted(),{from:t,to:e,toParams:n,then:i,cancel:o}}function u(t,e,n){return e.forEach(function(t){if(t.exitPrereqs)var e=t._exitPrereqs=when(t.exitPrereqs()).then(function(n){t._exitPrereqs==e&&(t._exitPrereqs.value=n)},function(){throw new Error("Failed to resolve EXIT prereqs of "+t.fullName)})}),t.forEach(function(t){if(t.enterPrereqs)var e=t._enterPrereqs=when(t.enterPrereqs(n)).then(function(n){t._enterPrereqs==e&&(t._enterPrereqs.value=n)},function(){throw new Error("Failed to resolve ENTER prereqs of "+t.fullName)})}),when.all(t.concat(e).map(function(t){return t._enterPrereqs||t._exitPrereqs}))}function c(t,e,n){e.forEach(function(t){t.exit(t._exitPrereqs&&t._exitPrereqs.value)}),y.allowed=!0,t.forEach(function(t){t.enter(n,t._enterPrereqs&&t._enterPrereqs.value)}),y.allowed=!1}function f(t,e,n,r){var i,o,a;if(n)t.parents.slice().reverse().forEach(function(t){for(a in r)if(t.params[a]||t.queryParams[a]){i=t;break}});else for(var s=0;s<t.parents.length;s++)if(o=t.parents[s],e.parents.indexOf(o)>-1){i=o;break}return i}function l(t,e,n){var r=t.parents,i=Math.min(r.length,r.indexOf(e)+(n?1:0));return[t].concat(r.slice(0,i))}function h(t,e,n){var r=!e||n;return l(t,e||t.root,r)}function p(){function t(t,e){p.name=t,p.parent=e,p.parents=r(),p.children=i(),p.fullName=a(),p.root=p.parents[p.parents.length-1],p.async=m.Async,c(function(t,e){e.init(t,p)}),h=!0}function n(){for(var t=p.path,e=p.parent;e;)e.path&&(t=e.path+"/"+t),e=e.parent;return t}function r(){for(var t=[],e=p.parent;e;)t.push(e),e=e.parent;return t}function i(){var t=[];for(var e in _)t.push(_[e]);return t}function o(t){var e={};for(var n in t)t[n]._isState&&(e[n]=t[n]);return e}function a(){return p.parents.reduceRight(function(t,e){return t+e.name+"."},"")+p.name}function s(t){var e={enter:1,exit:1,enterPrereqs:1,exitPrereqs:1},n={};for(var r in t)e[r]||t[r]._isState||(n[r]=t[r]);return n}function u(t,e){if(void 0!==e){if(void 0!==p.ownData[t])throw new Error("State "+p.fullName+" already has data with the key "+t);return p.ownData[t]=e,void 0}for(var n=p;void 0===n.ownData[t]&&n.parent;)n=n.parent;return n.ownData[t]}function c(t){for(var e in _)t(e,_[e])}function f(t,e){if(h)throw new Error("States can only be added before the Router is initialized");if(_[t])throw new Error("The state {0} already has a child state named {1}".replace("{0}",e.name).replace("{1}",t));_[t]=e}function l(){return p.fullName}var h,p={_isState:!0},g=d(arguments),v=g.options,_=o(g.options);return p.path=g.path,p.params=g.params,p.queryParams=g.queryParams,p.states=_,p.enter=v.enter||e,p.exit=v.exit||e,p.enterPrereqs=v.enterPrereqs,p.exitPrereqs=v.exitPrereqs,p.ownData=s(v),p.init=t,p.fullPath=n,p.data=u,p.addState=f,p.toString=l,p}function d(e){var r,i,o={path:"",options:{},params:{},queryParams:{}},a=e[0],s=e[1];return 1==e.length?t(a)?o.path=a:o.options=a:2==e.length&&(o.path=a,o.options="object"==typeof s?s:{enter:s}),r=o.path.indexOf("?"),-1!=r&&(o.queryParams=o.path.slice(r+1),o.path=o.path.slice(0,r),o.queryParams=n(o.queryParams.split("&"))),o.path=o.path.replace(/:\w*/g,function(t){return i=t.substring(1),o.params[i]=1,"{"+i+"}"}),o}function g(t){function e(t,e){n(t,e)||(L&&(w("Cancelling existing transition from {0} to {1}",L.from,L.to),L.cancel(),T.transition.cancelled.dispatch(L.from,L.to)),x&&w("Starting transition from {0}:{1} to {2}:{3}",E,JSON.stringify(q),t,JSON.stringify(e)),T.transition.started.dispatch(E,t),L=s(E,t,e,u(q,e)),L.then(function(){var n,r=E;E=t,q=e,L=null,N||k||(n=("/"+R).replace("//","/"),w("Pushing state: {0}",n),history.pushState(n,document.title,n)),w("Transition from {0} to {1} completed",r,t),T.transition.completed.dispatch(r,E),k=!1},function(e){L=null,logError("Transition from {0} to {1} failed: {2}",E,t,e),T.transition.failed.dispatch(E,t)}))}function n(t,e){var n,r,i;return L?(n=L.to,r=L.toParams):(n=E,r=q),i=u(r,e),t==n&&0==a(i)}function u(t,e){var n={},t=t||{};for(var r in t)t[r]!=e[r]&&(n[r]=1);for(var r in e)t[r]!=e[r]&&(n[r]=1);return n}function c(t){if(w("State not found: {0}",t),!B.notFound)throw new Error('State "'+t+'" could not be found');e(B.notFound)}function f(t){w("Router init"),l();var e=!g.ignoreInitialURL&&P()||t||"";return w("Initializing to state {0}",e||'""'),d(e),window.onpopstate=function(t){var e=t.state||P();w("Popped state: {0}",e),N=!0,_(e)},j=!0,T}function l(){h(function(t,e){e.init(t)}),A={},p(function(t){A[t.fullName]=t,t.route=$.addRoute(t.fullPath()+":?query:"),t.route.matched.add(function(){I=!0,e(t,b(t,arguments))})})}function h(t){for(var e in B)t(e,B[e])}function p(t){function e(n){n.forEach(function(n){n.children.length?e(n.children):t(n)})}e(r(B))}function d(t,e){var n=t.indexOf(".")>-1||A[t];w("Changing state to {0}",t||'""'),N=!1,n?m(t,e||{}):_(t)}function _(t){R=t,I=!1,$.parse(t),I||c(t)}function m(t,e){var n=A[t];if(!n)return c(t);var r=n.route.interpolate(e);_(r)}function y(t,e){if(j)throw new Error("States can only be added before the Router is initialized");if(B[t])throw new Error("A state already exist in the router with the name "+t);w("Adding state {0}",t),B[t]=e}function P(){var t=location.href.indexOf("#/");return t>-1?location.href.slice(t+2):(location.pathname+location.search).slice(1)}function b(t,e){var n,r=Array.prototype.slice.apply(e),i=r.pop(),a={};return t.fullPath().replace(/\{\w*\}/g,function(t){return n=t.slice(1,-1),a[n]=r.shift(),""}),i&&o(a,i),a}function O(t,e){var n={},r={},i=!1,a=A[t];if(!a)throw new Error("Cannot find state "+t);[a].concat(a.parents).forEach(function(t){o(r,t.queryParams)});for(var s in e)r[s]&&(n[s]=e[s],delete e[s],i=!0);return i&&(e.query=n),"/"+a.route.interpolate(e).replace("/?","?")}function S(t,e){T.transition.ended.dispatch(t,e)}var R,E,q,L,A,I,N,j,T={},B=i(t),$=crossroads.create(),k=!0;return $.shouldTypecast=!0,$.ignoreState=!0,v(T),T.init=f,T.state=d,T.addState=y,T.link=O,T.transition={started:new Signal,ended:new Signal,completed:new Signal,failed:new Signal,cancelled:new Signal},T.initialized=new Signal,T.transition.completed.addOnce(function(){T.initialized.dispatch()}),T.transition.completed.add(S),T.transition.failed.add(S),T.transition.cancelled.add(S),T}function v(t){document.addEventListener("click",function(e){if(!(e.defaultPrevented||e.metaKey||e.ctrlKey||1==e.button)){var n=_(e.target);n&&"_blank"!=n.getAttribute("target")&&n.hostname==location.hostname&&(e.preventDefault(),t.state(n.getAttribute("href")))}})}function _(t){for(;t;){if("A"==t.nodeName)return t;t=t.parentNode}}var m={},y=function(){function t(t){if(!n.allowed)throw new Error("Async can only be called from within state.enter()");var e=when.defer();return r.push(e),when(t).then(function(t){r.indexOf(e)>-1&&e.resolve(t)},function(t){r.indexOf(e)>-1&&e.reject(t)}),e.promise}function e(){r.length=0}var n,r=[];return n={register:t,newTransitionStarted:e,allowed:!1}}();m.Async=y.register,m.State=p;var w=logError=e,x=!1;return g.enableLogs=function(){function t(t){for(var e=t[0],n=Array.prototype.slice.call(t,1),r=0,i=n.length;i>r;r++)e=e.replace("{"+r+"}",n[r]);return e}x=!0,w=function(){console.log(t(arguments))},logError=function(){console.error(t(arguments))}},m.Router=g,m};"function"==typeof define&&define.amd?define(["abyssa"],t):"undefined"!=typeof module&&module.exports?module.exports=t():window.Abyssa=t()}();